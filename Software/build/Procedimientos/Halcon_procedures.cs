//
// File generated by HDevelop for HALCON/.NET (C#) Version 12.0.3
//

using HalconDotNet;

public partial class HDevelopExport
{
#if !(NO_EXPORT_MAIN || NO_EXPORT_APP_MAIN)
  public HDevelopExport()
  {
    // Default settings used in HDevelop 
    HOperatorSet.SetSystem("width", 512);
    HOperatorSet.SetSystem("height", 512);
    if (HalconAPI.isWindows)
      HOperatorSet.SetSystem("use_window_thread","true");
    action();
  }
#endif

  // Procedures 
  // External procedures 
  public void Calcula_PCA_lab_params (HObject ho_ImageWorkingRGB, HObject ho_Mascaraworking, 
      HObject ho_ImageLabIn, out HTuple hv_Trans, out HTuple hv_TransInv, out HTuple hv_MeanLab, 
      out HTuple hv_CovLab, out HTuple hv_InfoPerComp)
  {



    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_Imagenworking=null, ho_ImR=null;
    HObject ho_ImG=null, ho_ImB=null, ho_L=null, ho_a=null;
    HObject ho_b=null, ho_ImageLAB=null;

    // Local control variables 

    HTuple hv_num = null, hv_Exception = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Imagenworking);
    HOperatorSet.GenEmptyObj(out ho_ImR);
    HOperatorSet.GenEmptyObj(out ho_ImG);
    HOperatorSet.GenEmptyObj(out ho_ImB);
    HOperatorSet.GenEmptyObj(out ho_L);
    HOperatorSet.GenEmptyObj(out ho_a);
    HOperatorSet.GenEmptyObj(out ho_b);
    HOperatorSet.GenEmptyObj(out ho_ImageLAB);
    hv_InfoPerComp = new HTuple();
    try
    {
      HOperatorSet.CountObj(ho_ImageLabIn, out hv_num);
      if ((int)(new HTuple(hv_num.TupleEqual(0))) != 0)
      {
        ho_Imagenworking.Dispose();
        HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_Mascaraworking, out ho_Imagenworking
            );
        ho_ImR.Dispose();ho_ImG.Dispose();ho_ImB.Dispose();
        HOperatorSet.Decompose3(ho_Imagenworking, out ho_ImR, out ho_ImG, out ho_ImB
            );
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImR, out ExpTmpOutVar_0, "real");
        ho_ImR.Dispose();
        ho_ImR = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImG, out ExpTmpOutVar_0, "real");
        ho_ImG.Dispose();
        ho_ImG = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImB, out ExpTmpOutVar_0, "real");
        ho_ImB.Dispose();
        ho_ImB = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImR, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImR.Dispose();
        ho_ImR = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImG, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImG.Dispose();
        ho_ImG = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImB, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImB.Dispose();
        ho_ImB = ExpTmpOutVar_0;
        }
        ho_L.Dispose();ho_a.Dispose();ho_b.Dispose();
        HOperatorSet.TransFromRgb(ho_ImR, ho_ImG, ho_ImB, out ho_L, out ho_a, out ho_b, 
            "cielab");
        ho_ImageLAB.Dispose();
        HOperatorSet.Compose3(ho_L, ho_a, ho_b, out ho_ImageLAB);

      }
      else
      {
        ho_ImageLAB.Dispose();
        ho_ImageLAB = ho_ImageLabIn.CopyObj(1,-1);
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_ImageLAB, ho_Mascaraworking, out ExpTmpOutVar_0
          );
      ho_ImageLAB.Dispose();
      ho_ImageLAB = ExpTmpOutVar_0;
      }
      hv_TransInv = new HTuple();
      hv_Trans = new HTuple();
      hv_MeanLab = 0;
      hv_CovLab = 0;
      try
      {
        //para la comparacion de los espacios de color  Lab
        HOperatorSet.GenPrincipalCompTrans(ho_ImageLAB, out hv_Trans, out hv_TransInv, 
            out hv_MeanLab, out hv_CovLab, out hv_InfoPerComp);
      }
      // catch (Exception) 
      catch (HalconException HDevExpDefaultException1)
      {
        HDevExpDefaultException1.ToHTuple(out hv_Exception);
        hv_TransInv = new HTuple();
        hv_TransInv[0] = 0;
        hv_TransInv[1] = 0;
        hv_TransInv[2] = 0;
        hv_TransInv[3] = 0;
        hv_TransInv[4] = 0;
        hv_TransInv[5] = 0;
        hv_TransInv[6] = 0;
        hv_TransInv[7] = 0;
        hv_TransInv[8] = 0;
        hv_TransInv[9] = 0;
        hv_TransInv[10] = 0;
        hv_TransInv[11] = 0;
        if (hv_MeanLab == null)
          hv_MeanLab = new HTuple();
        hv_MeanLab[0] = 0;
        if (hv_MeanLab == null)
          hv_MeanLab = new HTuple();
        hv_MeanLab[1] = 0;
        if (hv_MeanLab == null)
          hv_MeanLab = new HTuple();
        hv_MeanLab[2] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[0] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[1] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[2] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[3] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[4] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[5] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[6] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[7] = 0;
        if (hv_CovLab == null)
          hv_CovLab = new HTuple();
        hv_CovLab[8] = 0;
      }

      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLAB.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLAB.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Calculo_desplazamineto_regiones (HObject ho_Region, HObject ho_Region2, 
      out HObject ho_patronfindmin, out HObject ho_patron, HTuple hv_Height, HTuple hv_Width, 
      HTuple hv_ancho, HTuple hv_zona_busqueda, HTuple hv_salto, out HTuple hv_desplaza)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_RegionOut=null, ho_Region2Out=null;
    HObject ho_RectangleFind, ho_Regiondesp=null, ho_patronfind=null;

    // Local control variables 

    HTuple hv_Row1 = null, hv_Column1 = null, hv_Row2 = null;
    HTuple hv_Column2 = null, hv_Row1in = null, hv_Column1in = null;
    HTuple hv_Row2in = null, hv_Column2in = null, hv_anchura_buscar_patron = null;
    HTuple hv_anchura_buscar_patron_in = null, hv_anchura_buscar_list = null;
    HTuple hv_pos_min = null, hv_minimo = null, hv_zona_trabajo = null;
    HTuple hv_rango_busqueda = null, hv_Index = null, hv_anchura_buscar = new HTuple();
    HTuple hv_anchura_buscar_in = new HTuple(), hv_diff_anchuras = new HTuple();
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_patronfindmin);
    HOperatorSet.GenEmptyObj(out ho_patron);
    HOperatorSet.GenEmptyObj(out ho_RegionOut);
    HOperatorSet.GenEmptyObj(out ho_Region2Out);
    HOperatorSet.GenEmptyObj(out ho_RectangleFind);
    HOperatorSet.GenEmptyObj(out ho_Regiondesp);
    HOperatorSet.GenEmptyObj(out ho_patronfind);
    try
    {
      ho_RegionOut.Dispose();
      ho_RegionOut = ho_Region.CopyObj(1,-1);
      ho_Region2Out.Dispose();
      ho_Region2Out = ho_Region2.CopyObj(1,-1);

      //elimino los agujeros si los hay
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.FillUp(ho_RegionOut, out ExpTmpOutVar_0);
      ho_RegionOut.Dispose();
      ho_RegionOut = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.FillUp(ho_Region2Out, out ExpTmpOutVar_0);
      ho_Region2Out.Dispose();
      ho_Region2Out = ExpTmpOutVar_0;
      }
      //creo region en la zona de coincidencia.
      ho_RectangleFind.Dispose();
      HOperatorSet.GenRectangle1(out ho_RectangleFind, 0, 0, hv_ancho, hv_Width);
      //interseccion de la dos regiones
      ho_patron.Dispose();
      HOperatorSet.Intersection(ho_RectangleFind, ho_RegionOut, out ho_patron);
      HOperatorSet.SmallestRectangle1(ho_patron, out hv_Row1, out hv_Column1, out hv_Row2, 
          out hv_Column2);
      HOperatorSet.InnerRectangle1(ho_patron, out hv_Row1in, out hv_Column1in, out hv_Row2in, 
          out hv_Column2in);

      hv_anchura_buscar_patron = hv_Column2-hv_Column1;
      hv_anchura_buscar_patron_in = hv_Column2in-hv_Column1in;
      //busca en el final de la imagen siguiente
      hv_anchura_buscar_list = new HTuple();
      hv_pos_min = 0;
      hv_minimo = hv_Width.Clone();
      hv_zona_trabajo = hv_Height-hv_zona_busqueda;
      hv_rango_busqueda = 40;
      //desde el final de la imaaen hacia rriba busco esa distancia
      HTuple end_val22 = hv_zona_trabajo-hv_rango_busqueda;
      HTuple step_val22 = -hv_salto;
      for (hv_Index=hv_zona_trabajo+hv_rango_busqueda; hv_Index.Continue(end_val22, step_val22); hv_Index = hv_Index.TupleAdd(step_val22))
      {
        ho_Regiondesp.Dispose();
        HOperatorSet.GenRectangle1(out ho_Regiondesp, hv_Index-hv_ancho, 0, hv_Index, 
            hv_Width);
        ho_patronfind.Dispose();
        HOperatorSet.Intersection(ho_Region2Out, ho_Regiondesp, out ho_patronfind
            );
        HOperatorSet.SmallestRectangle1(ho_patronfind, out hv_Row1, out hv_Column1, 
            out hv_Row2, out hv_Column2);
        HOperatorSet.InnerRectangle1(ho_patronfind, out hv_Row1in, out hv_Column1in, 
            out hv_Row2in, out hv_Column2in);
        hv_anchura_buscar = hv_Column2-hv_Column1;
        hv_anchura_buscar_in = hv_Column2in-hv_Column1in;
        hv_diff_anchuras = (((hv_anchura_buscar_patron-hv_anchura_buscar)).TupleAbs()
            )+(((hv_anchura_buscar_patron_in-hv_anchura_buscar_in)).TupleAbs());
        if ((int)(new HTuple(hv_diff_anchuras.TupleLess(hv_minimo))) != 0)
        {
          hv_pos_min = hv_Index.Clone();
          hv_minimo = hv_diff_anchuras.Clone();
          ho_patronfindmin.Dispose();
          ho_patronfindmin = ho_patronfind.CopyObj(1,-1);

        }
      }
      hv_desplaza = hv_Height-hv_pos_min;
      ho_RegionOut.Dispose();
      ho_Region2Out.Dispose();
      ho_RectangleFind.Dispose();
      ho_Regiondesp.Dispose();
      ho_patronfind.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_RegionOut.Dispose();
      ho_Region2Out.Dispose();
      ho_RectangleFind.Dispose();
      ho_Regiondesp.Dispose();
      ho_patronfind.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Process (HObject ho_ImagesSample, HTuple hv_Features, HTuple hv_ClassLUTHandle)
  {




    // Local iconic variables 

    HObject ho_Image1RGB, ho_Image1NIR;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Image1RGB);
    HOperatorSet.GenEmptyObj(out ho_Image1NIR);
    try
    {
      //Extraer características
      //- ImagesSample:
      // Image1RGB
      //
      ho_Image1RGB.Dispose();
      HOperatorSet.SelectObj(ho_ImagesSample, out ho_Image1RGB, 1);
      ho_Image1NIR.Dispose();
      HOperatorSet.SelectObj(ho_ImagesSample, out ho_Image1NIR, 2);
      optimar_extraer_caracteristicas_Peces_null(hv_Features);
      optimar_extraer_caracteristicas_Peces(ho_Image1RGB, ho_Image1NIR, hv_ClassLUTHandle, 
          hv_Features);

      ho_Image1RGB.Dispose();
      ho_Image1NIR.Dispose();

      return;

    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_Image1RGB.Dispose();
      ho_Image1NIR.Dispose();

      throw HDevExpDefaultException;
    }
  }

  // Short Description: Detect a fin 
  public void RC_optimar_contorno_imagen (HObject ho_ImagenEntradaRGB, HObject ho_ImagenEntradaNIR, 
      out HObject ho_Mascara, out HObject ho_Contorno, out HObject ho_ImagenSinFondoRGB, 
      out HObject ho_ImagenSinFondoNIR, HTuple hv_SinFondo, out HTuple hv_iniPez, 
      out HTuple hv_finPez, out HTuple hv_Largo, out HTuple hv_Ancho, out HTuple hv_Area, 
      out HTuple hv_Fila1, out HTuple hv_Fila2)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_ImagenNIR=null, ho_ImagenRGB=null;
    HObject ho_Region=null, ho_pezregion=null, ho_pezregions=null;
    HObject ho_ContornoSuavizado=null, ho_MascaraSuavizada=null;
    HObject ho_Mascarabin=null, ho_Region1=null;

    // Local control variables 

    HTuple hv_Width = new HTuple(), hv_Height = new HTuple();
    HTuple hv_numContornos = new HTuple(), hv_Column1 = new HTuple();
    HTuple hv_Column2 = new HTuple(), hv_Row = new HTuple();
    HTuple hv_Column = new HTuple(), hv_Row3 = new HTuple();
    HTuple hv_Column3 = new HTuple(), hv_Phi = new HTuple();
    HTuple hv_Length1 = new HTuple(), hv_Length2 = new HTuple();
    HTuple hv_Row1 = new HTuple(), hv_Row2 = new HTuple();
    HTuple hv_margen = new HTuple(), hv_Exception = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Mascara);
    HOperatorSet.GenEmptyObj(out ho_Contorno);
    HOperatorSet.GenEmptyObj(out ho_ImagenSinFondoRGB);
    HOperatorSet.GenEmptyObj(out ho_ImagenSinFondoNIR);
    HOperatorSet.GenEmptyObj(out ho_ImagenNIR);
    HOperatorSet.GenEmptyObj(out ho_ImagenRGB);
    HOperatorSet.GenEmptyObj(out ho_Region);
    HOperatorSet.GenEmptyObj(out ho_pezregion);
    HOperatorSet.GenEmptyObj(out ho_pezregions);
    HOperatorSet.GenEmptyObj(out ho_ContornoSuavizado);
    HOperatorSet.GenEmptyObj(out ho_MascaraSuavizada);
    HOperatorSet.GenEmptyObj(out ho_Mascarabin);
    HOperatorSet.GenEmptyObj(out ho_Region1);
    hv_iniPez = new HTuple();
    hv_finPez = new HTuple();
    hv_Largo = new HTuple();
    hv_Ancho = new HTuple();
    hv_Area = new HTuple();
    hv_Fila1 = new HTuple();
    hv_Fila2 = new HTuple();
    try
    {
      //  Parámetros de entrada:
      //    - ImagenEntrada
      //
      //  Parámetros de salida:
      //    - Mascara
      //    - Contorno
      //    - ContornoSuavizado
      //    - MascaraFilaMin
      //    - MascaraFilaMax
      //    - ImagenSinFondo

      try
      {

        ho_ImagenNIR.Dispose();
        ho_ImagenNIR = ho_ImagenEntradaNIR.CopyObj(1,-1);
        ho_ImagenRGB.Dispose();
        ho_ImagenRGB = ho_ImagenEntradaRGB.CopyObj(1,-1);

        hv_Largo = 0;
        hv_Ancho = 0;
        hv_iniPez = 0;
        hv_finPez = 0;
        ho_ImagenSinFondoRGB.Dispose();
        HOperatorSet.GenEmptyObj(out ho_ImagenSinFondoRGB);
        ho_ImagenSinFondoNIR.Dispose();
        HOperatorSet.GenEmptyObj(out ho_ImagenSinFondoNIR);

        //Ancho y largo de la imagen
        HOperatorSet.GetImageSize(ho_ImagenEntradaRGB, out hv_Width, out hv_Height);
        if ((int)(new HTuple(hv_SinFondo.TupleEqual(0))) != 0)
        {
          ho_Region.Dispose();
          SegmentImageHSV(ho_ImagenEntradaRGB, out ho_Region);
          ho_pezregion.Dispose();
          HOperatorSet.FillUp(ho_Region, out ho_pezregion);
          ho_pezregions.Dispose();
          HOperatorSet.Connection(ho_pezregion, out ho_pezregions);
          ho_pezregion.Dispose();
          HOperatorSet.SelectShapeStd(ho_pezregions, out ho_pezregion, "max_area", 
              100);
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.FillUp(ho_pezregion, out ExpTmpOutVar_0);
          ho_pezregion.Dispose();
          ho_pezregion = ExpTmpOutVar_0;
          }
        }
        else
        {
          ho_pezregion.Dispose();
          HOperatorSet.Threshold(ho_ImagenNIR, out ho_pezregion, 1, 255);
        }


        //sacar contorno
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.Connection(ho_pezregion, out ExpTmpOutVar_0);
        ho_pezregion.Dispose();
        ho_pezregion = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.SelectShapeStd(ho_pezregion, out ExpTmpOutVar_0, "max_area", 
            100);
        ho_pezregion.Dispose();
        ho_pezregion = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ErosionCircle(ho_pezregion, out ExpTmpOutVar_0, 1.5);
        ho_pezregion.Dispose();
        ho_pezregion = ExpTmpOutVar_0;
        }
        ho_Contorno.Dispose();
        HOperatorSet.GenContourRegionXld(ho_pezregion, out ho_Contorno, "border");
        ho_ContornoSuavizado.Dispose();
        HOperatorSet.SmoothContoursXld(ho_Contorno, out ho_ContornoSuavizado, 69);
        ho_MascaraSuavizada.Dispose();
        HOperatorSet.GenRegionContourXld(ho_ContornoSuavizado, out ho_MascaraSuavizada, 
            "filled");

        //selecciono el de mayor area
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.SelectShapeStd(ho_MascaraSuavizada, out ExpTmpOutVar_0, "max_area", 
            100);
        ho_MascaraSuavizada.Dispose();
        ho_MascaraSuavizada = ExpTmpOutVar_0;
        }

        ho_Contorno.Dispose();
        ho_Contorno = ho_ContornoSuavizado.CopyObj(1,-1);
        ho_Mascara.Dispose();
        ho_Mascara = ho_MascaraSuavizada.CopyObj(1,-1);

        //mirar si hay pez
        HOperatorSet.GetImageSize(ho_ImagenEntradaRGB, out hv_Width, out hv_Height);

        //ver si sólo hay un contorno
        HOperatorSet.CountObj(ho_Contorno, out hv_numContornos);
        HOperatorSet.SmallestRectangle1(ho_Mascara, out hv_Fila1, out hv_Column1, 
            out hv_Fila2, out hv_Column2);
        hv_iniPez = 0;
        if ((int)(new HTuple(hv_Fila2.TupleLess(hv_Height-20))) != 0)
        {
          hv_iniPez = 1;
        }

        hv_finPez = 0;
        if ((int)(new HTuple(hv_Fila1.TupleGreater(20))) != 0)
        {
          hv_finPez = 1;
        }

        HOperatorSet.AreaCenter(ho_Mascara, out hv_Area, out hv_Row, out hv_Column);
        HOperatorSet.SmallestRectangle2(ho_Mascara, out hv_Row3, out hv_Column3, 
            out hv_Phi, out hv_Length1, out hv_Length2);
        hv_Largo = hv_Length1*2;
        hv_Ancho = hv_Length2*2;
        ho_Mascarabin.Dispose();
        HOperatorSet.RegionToBin(ho_Mascara, out ho_Mascarabin, 255, 0, hv_Width, 
            hv_Height);
        //Imagen Sin Fondo

        HOperatorSet.SmallestRectangle1(ho_Mascara, out hv_Row1, out hv_Column1, 
            out hv_Row2, out hv_Column2);
        ho_ImagenSinFondoRGB.Dispose();
        HOperatorSet.ReduceDomain(ho_ImagenRGB, ho_Mascara, out ho_ImagenSinFondoRGB
            );
        ho_ImagenSinFondoNIR.Dispose();
        HOperatorSet.ReduceDomain(ho_ImagenNIR, ho_Mascara, out ho_ImagenSinFondoNIR
            );
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ReduceDomain(ho_Mascarabin, ho_Mascara, out ExpTmpOutVar_0);
        ho_Mascarabin.Dispose();
        ho_Mascarabin = ExpTmpOutVar_0;
        }
        hv_margen = 0;
        if ((int)(new HTuple(hv_SinFondo.TupleEqual(1))) != 0)
        {
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.CropRectangle1(ho_ImagenSinFondoRGB, out ExpTmpOutVar_0, hv_Row1-hv_margen, 
              hv_Column1-hv_margen, hv_Row2+hv_margen, hv_Column2+hv_margen);
          ho_ImagenSinFondoRGB.Dispose();
          ho_ImagenSinFondoRGB = ExpTmpOutVar_0;
          }
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.CropRectangle1(ho_ImagenSinFondoNIR, out ExpTmpOutVar_0, hv_Row1-hv_margen, 
              hv_Column1-hv_margen, hv_Row2+hv_margen, hv_Column2+hv_margen);
          ho_ImagenSinFondoNIR.Dispose();
          ho_ImagenSinFondoNIR = ExpTmpOutVar_0;
          }
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.CropRectangle1(ho_Mascarabin, out ExpTmpOutVar_0, hv_Row1-hv_margen, 
              hv_Column1-hv_margen, hv_Row2+hv_margen, hv_Column2+hv_margen);
          ho_Mascarabin.Dispose();
          ho_Mascarabin = ExpTmpOutVar_0;
          }

          ho_Region1.Dispose();
          HOperatorSet.Threshold(ho_Mascarabin, out ho_Region1, 128, 255);
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.ReduceDomain(ho_ImagenSinFondoRGB, ho_Region1, out ExpTmpOutVar_0
              );
          ho_ImagenSinFondoRGB.Dispose();
          ho_ImagenSinFondoRGB = ExpTmpOutVar_0;
          }
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.ReduceDomain(ho_ImagenSinFondoNIR, ho_Region1, out ExpTmpOutVar_0
              );
          ho_ImagenSinFondoNIR.Dispose();
          ho_ImagenSinFondoNIR = ExpTmpOutVar_0;
          }
          ho_Mascara.Dispose();
          ho_Mascara = ho_Region1.CopyObj(1,-1);

        }



      }
      // catch (Exception) 
      catch (HalconException HDevExpDefaultException1)
      {
        HDevExpDefaultException1.ToHTuple(out hv_Exception);
        //No hay imagen
      }


      ho_ImagenNIR.Dispose();
      ho_ImagenRGB.Dispose();
      ho_Region.Dispose();
      ho_pezregion.Dispose();
      ho_pezregions.Dispose();
      ho_ContornoSuavizado.Dispose();
      ho_MascaraSuavizada.Dispose();
      ho_Mascarabin.Dispose();
      ho_Region1.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ImagenNIR.Dispose();
      ho_ImagenRGB.Dispose();
      ho_Region.Dispose();
      ho_pezregion.Dispose();
      ho_pezregions.Dispose();
      ho_ContornoSuavizado.Dispose();
      ho_MascaraSuavizada.Dispose();
      ho_Mascarabin.Dispose();
      ho_Region1.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Color_region_extractor (HObject ho_ImageWorkingRGB, HObject ho_RegionWorking, 
      HObject ho_ImageLabIn, out HObject ho_Color_region, out HObject ho_ImageLabOut, 
      HTuple hv_Radius, HTuple hv_Center)
  {




    // Local iconic variables 

    HObject ho_Domain, ho_R, ho_G, ho_B, ho_ImageResult;
    HObject ho_Region, ho_Regions1diff, ho_Regions1;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Color_region);
    HOperatorSet.GenEmptyObj(out ho_ImageLabOut);
    HOperatorSet.GenEmptyObj(out ho_Domain);
    HOperatorSet.GenEmptyObj(out ho_R);
    HOperatorSet.GenEmptyObj(out ho_G);
    HOperatorSet.GenEmptyObj(out ho_B);
    HOperatorSet.GenEmptyObj(out ho_ImageResult);
    HOperatorSet.GenEmptyObj(out ho_Region);
    HOperatorSet.GenEmptyObj(out ho_Regions1diff);
    HOperatorSet.GenEmptyObj(out ho_Regions1);
    try
    {
      //verde inicial para atinar
      //saca lo verde a partir de la imagen recuperada de iluminacion

      ho_Domain.Dispose();
      HOperatorSet.GetDomain(ho_ImageWorkingRGB, out ho_Domain);

      ho_R.Dispose();ho_G.Dispose();ho_B.Dispose();
      HOperatorSet.Decompose3(ho_ImageWorkingRGB, out ho_R, out ho_G, out ho_B);
      ho_ImageResult.Dispose();
      HOperatorSet.DivImage(ho_G, ho_B, out ho_ImageResult, 255, 0);
      ho_Region.Dispose();
      HOperatorSet.Threshold(ho_ImageResult, out ho_Region, 180, 255);

      ho_Regions1diff.Dispose();
      HOperatorSet.Difference(ho_Domain, ho_Region, out ho_Regions1diff);
      ho_Regions1.Dispose();
      HOperatorSet.Union1(ho_Regions1diff, out ho_Regions1);
      ho_Color_region.Dispose();
      ho_Color_region = ho_Regions1.CopyObj(1,-1);


      ho_Domain.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_ImageResult.Dispose();
      ho_Region.Dispose();
      ho_Regions1diff.Dispose();
      ho_Regions1.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_Domain.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_ImageResult.Dispose();
      ho_Region.Dispose();
      ho_Regions1diff.Dispose();
      ho_Regions1.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Difuminado_rapido_gauss (HObject ho_Rgb_blanco, HObject ho_region, 
      out HObject ho_Rgb_blancoOut, HTuple hv_resize_factor, HTuple hv_gauss_size)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_total_reg, ho_region_fondo, ho_R=null;
    HObject ho_G=null, ho_B=null;

    // Local control variables 

    HTuple hv_numchanels = null, hv_Width = null;
    HTuple hv_Height = null, hv_Mean = new HTuple(), hv_Deviation = new HTuple();
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Rgb_blancoOut);
    HOperatorSet.GenEmptyObj(out ho_total_reg);
    HOperatorSet.GenEmptyObj(out ho_region_fondo);
    HOperatorSet.GenEmptyObj(out ho_R);
    HOperatorSet.GenEmptyObj(out ho_G);
    HOperatorSet.GenEmptyObj(out ho_B);
    try
    {
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ho_Rgb_blanco.CopyObj(1,-1);
      HOperatorSet.CountChannels(ho_Rgb_blancoOut, out hv_numchanels);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.FullDomain(ho_Rgb_blancoOut, out ExpTmpOutVar_0);
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ExpTmpOutVar_0;
      }
      HOperatorSet.GetImageSize(ho_Rgb_blancoOut, out hv_Width, out hv_Height);
      ho_total_reg.Dispose();
      HOperatorSet.GenRectangle1(out ho_total_reg, 0, 0, hv_Height, hv_Width);
      ho_region_fondo.Dispose();
      HOperatorSet.Difference(ho_total_reg, ho_region, out ho_region_fondo);
      if ((int)(new HTuple(hv_numchanels.TupleEqual(1))) != 0)
      {
        HOperatorSet.Intensity(ho_region, ho_Rgb_blancoOut, out hv_Mean, out hv_Deviation);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.PaintRegion(ho_region_fondo, ho_Rgb_blancoOut, out ExpTmpOutVar_0, 
            hv_Mean, "fill");
        ho_Rgb_blancoOut.Dispose();
        ho_Rgb_blancoOut = ExpTmpOutVar_0;
        }
      }

      if ((int)(new HTuple(hv_numchanels.TupleEqual(3))) != 0)
      {
        ho_R.Dispose();ho_G.Dispose();ho_B.Dispose();
        HOperatorSet.Decompose3(ho_Rgb_blancoOut, out ho_R, out ho_G, out ho_B);
        HOperatorSet.Intensity(ho_region, ho_R, out hv_Mean, out hv_Deviation);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.PaintRegion(ho_region_fondo, ho_R, out ExpTmpOutVar_0, hv_Mean, 
            "fill");
        ho_R.Dispose();
        ho_R = ExpTmpOutVar_0;
        }
        HOperatorSet.Intensity(ho_region, ho_G, out hv_Mean, out hv_Deviation);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.PaintRegion(ho_region_fondo, ho_G, out ExpTmpOutVar_0, hv_Mean, 
            "fill");
        ho_G.Dispose();
        ho_G = ExpTmpOutVar_0;
        }
        HOperatorSet.Intensity(ho_region, ho_B, out hv_Mean, out hv_Deviation);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.PaintRegion(ho_region_fondo, ho_B, out ExpTmpOutVar_0, hv_Mean, 
            "fill");
        ho_B.Dispose();
        ho_B = ExpTmpOutVar_0;
        }
        ho_Rgb_blancoOut.Dispose();
        HOperatorSet.Compose3(ho_R, ho_G, ho_B, out ho_Rgb_blancoOut);
      }

      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ZoomImageSize(ho_Rgb_blancoOut, out ExpTmpOutVar_0, hv_Width/hv_resize_factor, 
          hv_Height/hv_resize_factor, "constant");
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.SmoothImage(ho_Rgb_blancoOut, out ExpTmpOutVar_0, "gauss", hv_gauss_size);
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ZoomImageSize(ho_Rgb_blancoOut, out ExpTmpOutVar_0, hv_Width, 
          hv_Height, "constant");
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_Rgb_blancoOut, ho_region, out ExpTmpOutVar_0);
      ho_Rgb_blancoOut.Dispose();
      ho_Rgb_blancoOut = ExpTmpOutVar_0;
      }
      ho_total_reg.Dispose();
      ho_region_fondo.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_total_reg.Dispose();
      ho_region_fondo.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Histo_ab_generator (HObject ho_ImageWorkingRGB, HObject ho_Mascara, 
      HObject ho_ImageLabIn, out HObject ho_HistogramOut, HTuple hv_gaussSize, HTuple hv_MAX_Val)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_Imagenworking=null, ho_ImR=null;
    HObject ho_ImG=null, ho_ImB=null, ho_L=null, ho_a=null;
    HObject ho_b=null, ho_ImageLAB=null, ho_Histo2Dim, ho_Histo2Dimreal;
    HObject ho_Histo2Dimrealgauss;

    // Local control variables 

    HTuple hv_num = null, hv_Max = null, hv_Min = null;
    HTuple hv_mult = null, hv_add = null, hv_Area = null, hv_Row4 = null;
    HTuple hv_Column4 = null;
    HTuple   hv_MAX_Val_COPY_INP_TMP = hv_MAX_Val.Clone();

    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_HistogramOut);
    HOperatorSet.GenEmptyObj(out ho_Imagenworking);
    HOperatorSet.GenEmptyObj(out ho_ImR);
    HOperatorSet.GenEmptyObj(out ho_ImG);
    HOperatorSet.GenEmptyObj(out ho_ImB);
    HOperatorSet.GenEmptyObj(out ho_L);
    HOperatorSet.GenEmptyObj(out ho_a);
    HOperatorSet.GenEmptyObj(out ho_b);
    HOperatorSet.GenEmptyObj(out ho_ImageLAB);
    HOperatorSet.GenEmptyObj(out ho_Histo2Dim);
    HOperatorSet.GenEmptyObj(out ho_Histo2Dimreal);
    HOperatorSet.GenEmptyObj(out ho_Histo2Dimrealgauss);
    try
    {
      HOperatorSet.CountObj(ho_ImageLabIn, out hv_num);
      if ((int)(new HTuple(hv_num.TupleEqual(0))) != 0)
      {
        ho_Imagenworking.Dispose();
        HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_Mascara, out ho_Imagenworking
            );
        ho_ImR.Dispose();ho_ImG.Dispose();ho_ImB.Dispose();
        HOperatorSet.Decompose3(ho_Imagenworking, out ho_ImR, out ho_ImG, out ho_ImB
            );
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImR, out ExpTmpOutVar_0, "real");
        ho_ImR.Dispose();
        ho_ImR = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImG, out ExpTmpOutVar_0, "real");
        ho_ImG.Dispose();
        ho_ImG = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConvertImageType(ho_ImB, out ExpTmpOutVar_0, "real");
        ho_ImB.Dispose();
        ho_ImB = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImR, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImR.Dispose();
        ho_ImR = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImG, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImG.Dispose();
        ho_ImG = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ScaleImage(ho_ImB, out ExpTmpOutVar_0, 1/255.0, 0.0);
        ho_ImB.Dispose();
        ho_ImB = ExpTmpOutVar_0;
        }
        ho_L.Dispose();ho_a.Dispose();ho_b.Dispose();
        HOperatorSet.TransFromRgb(ho_ImR, ho_ImG, ho_ImB, out ho_L, out ho_a, out ho_b, 
            "cielab");
        ho_ImageLAB.Dispose();
        HOperatorSet.Compose3(ho_L, ho_a, ho_b, out ho_ImageLAB);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ReduceDomain(ho_ImageLAB, ho_Mascara, out ExpTmpOutVar_0);
        ho_ImageLAB.Dispose();
        ho_ImageLAB = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ReduceDomain(ho_L, ho_Mascara, out ExpTmpOutVar_0);
        ho_L.Dispose();
        ho_L = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ReduceDomain(ho_a, ho_Mascara, out ExpTmpOutVar_0);
        ho_a.Dispose();
        ho_a = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ReduceDomain(ho_b, ho_Mascara, out ExpTmpOutVar_0);
        ho_b.Dispose();
        ho_b = ExpTmpOutVar_0;
        }
      }
      else
      {
        ho_ImageLAB.Dispose();
        ho_ImageLAB = ho_ImageLabIn.CopyObj(1,-1);
        ho_L.Dispose();ho_a.Dispose();ho_b.Dispose();
        HOperatorSet.Decompose3(ho_ImageLAB, out ho_L, out ho_a, out ho_b);
      }
      //espacio de color Lab
      hv_Max = 98.0;
      hv_Min = -86.0;
      HOperatorSet.TupleReal(hv_MAX_Val_COPY_INP_TMP, out hv_MAX_Val_COPY_INP_TMP);
      HOperatorSet.TupleReal(hv_Max, out hv_Max);
      HOperatorSet.TupleReal(hv_Min, out hv_Min);
      hv_mult = hv_MAX_Val_COPY_INP_TMP/(hv_Max-hv_Min);
      hv_add = (-hv_mult)*hv_Min;
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_a, out ExpTmpOutVar_0, hv_mult, hv_add);
      ho_a.Dispose();
      ho_a = ExpTmpOutVar_0;
      }

      hv_Max = 95.0;
      hv_Min = -108.0;
      HOperatorSet.TupleReal(hv_MAX_Val_COPY_INP_TMP, out hv_MAX_Val_COPY_INP_TMP);
      HOperatorSet.TupleReal(hv_Max, out hv_Max);
      HOperatorSet.TupleReal(hv_Min, out hv_Min);
      hv_mult = hv_MAX_Val_COPY_INP_TMP/(hv_Max-hv_Min);
      hv_add = (-hv_mult)*hv_Min;
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_b, out ExpTmpOutVar_0, hv_mult, hv_add);
      ho_b.Dispose();
      ho_b = ExpTmpOutVar_0;
      }

      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_a, out ExpTmpOutVar_0, "byte");
      ho_a.Dispose();
      ho_a = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_b, out ExpTmpOutVar_0, "byte");
      ho_b.Dispose();
      ho_b = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_a, ho_Mascara, out ExpTmpOutVar_0);
      ho_a.Dispose();
      ho_a = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_b, ho_Mascara, out ExpTmpOutVar_0);
      ho_b.Dispose();
      ho_b = ExpTmpOutVar_0;
      }
      ho_Histo2Dim.Dispose();
      HOperatorSet.Histo2dim(ho_Mascara, ho_a, ho_b, out ho_Histo2Dim);
      //visualiza la imagen
      //compose2 (a, b, ab)
      //scale_image (ab, ab, 10, 0)

      ho_Histo2Dimreal.Dispose();
      HOperatorSet.ConvertImageType(ho_Histo2Dim, out ho_Histo2Dimreal, "real");
      //escalodo para tener referenia igual a todos las imagenes
      HOperatorSet.AreaCenter(ho_Mascara, out hv_Area, out hv_Row4, out hv_Column4);
      HOperatorSet.TupleReal(hv_Area, out hv_Area);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_Histo2Dimreal, out ExpTmpOutVar_0, 100.0/hv_Area, 
          0);
      ho_Histo2Dimreal.Dispose();
      ho_Histo2Dimreal = ExpTmpOutVar_0;
      }
      ho_Histo2Dimrealgauss.Dispose();
      HOperatorSet.SmoothImage(ho_Histo2Dimreal, out ho_Histo2Dimrealgauss, "gauss", 
          hv_gaussSize);
      ho_HistogramOut.Dispose();
      ho_HistogramOut = ho_Histo2Dimrealgauss.CopyObj(1,-1);
      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLAB.Dispose();
      ho_Histo2Dim.Dispose();
      ho_Histo2Dimreal.Dispose();
      ho_Histo2Dimrealgauss.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLAB.Dispose();
      ho_Histo2Dim.Dispose();
      ho_Histo2Dimreal.Dispose();
      ho_Histo2Dimrealgauss.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Histo_gray_generator (HObject ho_ImageWorking, HObject ho_Mascara, 
      HTuple hv_MAX_Val, out HTuple hv_HistogramOut)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_regionInteres, ho_Imagenworkingtemp;
    HObject ho_a;

    // Local control variables 

    HTuple hv_Max = null, hv_Min = null, hv_Area = null;
    HTuple hv_Row = null, hv_Column = null, hv_mult = null;
    HTuple hv_add = null, hv_AbsoluteHisto1 = null, hv_RelativeHisto1 = null;
    HTuple   hv_MAX_Val_COPY_INP_TMP = hv_MAX_Val.Clone();

    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_regionInteres);
    HOperatorSet.GenEmptyObj(out ho_Imagenworkingtemp);
    HOperatorSet.GenEmptyObj(out ho_a);
    try
    {
      //elimino los brillos
      //elimino los brillos

      hv_Max = 255;
      hv_Min = 0;
      ho_regionInteres.Dispose();
      HOperatorSet.Threshold(ho_ImageWorking, out ho_regionInteres, hv_Min, hv_Max);
      HOperatorSet.AreaCenter(ho_Mascara, out hv_Area, out hv_Row, out hv_Column);
      HOperatorSet.TupleReal(hv_Area, out hv_Area);
      hv_Area = hv_Area/100;
      ho_Imagenworkingtemp.Dispose();
      HOperatorSet.ReduceDomain(ho_ImageWorking, ho_regionInteres, out ho_Imagenworkingtemp
          );
      //espacio de color Lab

      HOperatorSet.TupleReal(hv_MAX_Val_COPY_INP_TMP, out hv_MAX_Val_COPY_INP_TMP);
      HOperatorSet.TupleReal(hv_Max, out hv_Max);
      HOperatorSet.TupleReal(hv_Min, out hv_Min);
      hv_mult = hv_MAX_Val_COPY_INP_TMP/(hv_Max-hv_Min);
      hv_add = (-hv_mult)*hv_Min;
      ho_a.Dispose();
      HOperatorSet.ScaleImage(ho_Imagenworkingtemp, out ho_a, hv_mult, hv_add);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_a, out ExpTmpOutVar_0, "byte");
      ho_a.Dispose();
      ho_a = ExpTmpOutVar_0;
      }
      HOperatorSet.GrayHisto(ho_regionInteres, ho_a, out hv_AbsoluteHisto1, out hv_RelativeHisto1);
      hv_HistogramOut = hv_AbsoluteHisto1/hv_Area;
      ho_regionInteres.Dispose();
      ho_Imagenworkingtemp.Dispose();
      ho_a.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_regionInteres.Dispose();
      ho_Imagenworkingtemp.Dispose();
      ho_a.Dispose();

      throw HDevExpDefaultException;
    }
  }

  // Short Description: Detect a fin 
  public void RC_optimar_identificar_rapido (HObject ho_Imagen, HObject ho_ImagenRgbWhite, 
      HObject ho_ROI_0, HTuple hv_scale_1_1, out HTuple hv_result, out HTuple hv_Y_start)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_RegionZoom=null, ho_ImagenRgbWhiterecortada=null;
    HObject ho_ImagenRecortada=null, ho_ImagenRgbcorregida=null;
    HObject ho_ImageR=null, ho_ImageG=null, ho_ImageB=null;
    HObject ho_Region=null, ho_pezregion=null, ho_pezregions=null;

    // Local copy input parameter variables 
    HObject ho_Imagen_COPY_INP_TMP;
    ho_Imagen_COPY_INP_TMP = ho_Imagen.CopyObj(1,-1);
    HObject ho_ImagenRgbWhite_COPY_INP_TMP;
    ho_ImagenRgbWhite_COPY_INP_TMP = ho_ImagenRgbWhite.CopyObj(1,-1);



    // Local control variables 

    HTuple hv_factor_scala = new HTuple(), hv_Row21 = new HTuple();
    HTuple hv_Area = new HTuple(), hv_Width = new HTuple();
    HTuple hv_Height = new HTuple(), hv_Row1 = new HTuple();
    HTuple hv_Column1 = new HTuple(), hv_Row2 = new HTuple();
    HTuple hv_Column2 = new HTuple(), hv_Mean = new HTuple();
    HTuple hv_Deviation = new HTuple(), hv_countelements = new HTuple();
    HTuple hv_R1 = new HTuple(), hv_C1 = new HTuple(), hv_Row11 = new HTuple();
    HTuple hv_Column11 = new HTuple(), hv_Column21 = new HTuple();
    HTuple hv_Exception = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_RegionZoom);
    HOperatorSet.GenEmptyObj(out ho_ImagenRgbWhiterecortada);
    HOperatorSet.GenEmptyObj(out ho_ImagenRecortada);
    HOperatorSet.GenEmptyObj(out ho_ImagenRgbcorregida);
    HOperatorSet.GenEmptyObj(out ho_ImageR);
    HOperatorSet.GenEmptyObj(out ho_ImageG);
    HOperatorSet.GenEmptyObj(out ho_ImageB);
    HOperatorSet.GenEmptyObj(out ho_Region);
    HOperatorSet.GenEmptyObj(out ho_pezregion);
    HOperatorSet.GenEmptyObj(out ho_pezregions);
    hv_result = new HTuple();
    hv_Y_start = new HTuple();
    try
    {
      //  Parámetros de entrada:
      //    - Imagen
      //
      //  Parámetros de salida:
      //    - result
      try
      {
        //Guardar la imagen de entrada para el final
        hv_factor_scala = 0.5/hv_scale_1_1;
        hv_Row21 = 0;
        hv_Area = 0;
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ZoomImageFactor(ho_Imagen_COPY_INP_TMP, out ExpTmpOutVar_0, 
            hv_factor_scala, hv_factor_scala, "constant");
        ho_Imagen_COPY_INP_TMP.Dispose();
        ho_Imagen_COPY_INP_TMP = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ZoomImageFactor(ho_ImagenRgbWhite_COPY_INP_TMP, out ExpTmpOutVar_0, 
            hv_factor_scala, hv_factor_scala, "constant");
        ho_ImagenRgbWhite_COPY_INP_TMP.Dispose();
        ho_ImagenRgbWhite_COPY_INP_TMP = ExpTmpOutVar_0;
        }

        ho_RegionZoom.Dispose();
        HOperatorSet.ZoomRegion(ho_ROI_0, out ho_RegionZoom, hv_factor_scala, hv_factor_scala);

        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.FullDomain(ho_Imagen_COPY_INP_TMP, out ExpTmpOutVar_0);
        ho_Imagen_COPY_INP_TMP.Dispose();
        ho_Imagen_COPY_INP_TMP = ExpTmpOutVar_0;
        }
        HOperatorSet.GetImageSize(ho_Imagen_COPY_INP_TMP, out hv_Width, out hv_Height);

        HOperatorSet.SmallestRectangle1(ho_RegionZoom, out hv_Row1, out hv_Column1, 
            out hv_Row2, out hv_Column2);
        ho_ImagenRgbWhiterecortada.Dispose();
        HOperatorSet.CropRectangle1(ho_ImagenRgbWhite_COPY_INP_TMP, out ho_ImagenRgbWhiterecortada, 
            hv_Row1, hv_Column1, hv_Row2, hv_Column2);
        ho_ImagenRecortada.Dispose();
        HOperatorSet.CropRectangle1(ho_Imagen_COPY_INP_TMP, out ho_ImagenRecortada, 
            hv_Row1, hv_Column1, hv_Row2, hv_Column2);

        ho_ImagenRgbcorregida.Dispose();
        HOperatorSet.DivImage(ho_ImagenRecortada, ho_ImagenRgbWhiterecortada, out ho_ImagenRgbcorregida, 
            200, 0);


        ho_ImageR.Dispose();ho_ImageG.Dispose();ho_ImageB.Dispose();
        HOperatorSet.Decompose3(ho_ImagenRgbcorregida, out ho_ImageR, out ho_ImageG, 
            out ho_ImageB);
        HOperatorSet.Intensity(ho_RegionZoom, ho_ImageB, out hv_Mean, out hv_Deviation);
        if ((int)(new HTuple(hv_Mean.TupleLess(40))) != 0)
        {
          //fallo falta de iluminacion
          hv_result = -1;
          hv_Y_start = 0;
          ho_Imagen_COPY_INP_TMP.Dispose();
          ho_ImagenRgbWhite_COPY_INP_TMP.Dispose();
          ho_RegionZoom.Dispose();
          ho_ImagenRgbWhiterecortada.Dispose();
          ho_ImagenRecortada.Dispose();
          ho_ImagenRgbcorregida.Dispose();
          ho_ImageR.Dispose();
          ho_ImageG.Dispose();
          ho_ImageB.Dispose();
          ho_Region.Dispose();
          ho_pezregion.Dispose();
          ho_pezregions.Dispose();

          return;

        }

        ho_Region.Dispose();
        SegmentImageHSV(ho_ImagenRgbcorregida, out ho_Region);
        HOperatorSet.CountObj(ho_Region, out hv_countelements);
        if ((int)(new HTuple(hv_countelements.TupleGreater(0))) != 0)
        {
          ho_pezregion.Dispose();
          HOperatorSet.FillUp(ho_Region, out ho_pezregion);
          ho_pezregions.Dispose();
          HOperatorSet.Connection(ho_pezregion, out ho_pezregions);
          ho_pezregion.Dispose();
          HOperatorSet.SelectShapeStd(ho_pezregions, out ho_pezregion, "max_area", 
              100);
          HOperatorSet.AreaCenter(ho_pezregion, out hv_Area, out hv_R1, out hv_C1);
          HOperatorSet.SmallestRectangle1(ho_pezregion, out hv_Row11, out hv_Column11, 
              out hv_Row21, out hv_Column21);
        }


        hv_Area = hv_Area/(0.5*0.5);
        hv_R1 = hv_Row21/hv_factor_scala;
        hv_result = hv_Area.Clone();
        hv_Y_start = hv_R1.Clone();

      }
      // catch (Exception) 
      catch (HalconException HDevExpDefaultException1)
      {
        HDevExpDefaultException1.ToHTuple(out hv_Exception);
      }



      ho_Imagen_COPY_INP_TMP.Dispose();
      ho_ImagenRgbWhite_COPY_INP_TMP.Dispose();
      ho_RegionZoom.Dispose();
      ho_ImagenRgbWhiterecortada.Dispose();
      ho_ImagenRecortada.Dispose();
      ho_ImagenRgbcorregida.Dispose();
      ho_ImageR.Dispose();
      ho_ImageG.Dispose();
      ho_ImageB.Dispose();
      ho_Region.Dispose();
      ho_pezregion.Dispose();
      ho_pezregions.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_Imagen_COPY_INP_TMP.Dispose();
      ho_ImagenRgbWhite_COPY_INP_TMP.Dispose();
      ho_RegionZoom.Dispose();
      ho_ImagenRgbWhiterecortada.Dispose();
      ho_ImagenRecortada.Dispose();
      ho_ImagenRgbcorregida.Dispose();
      ho_ImageR.Dispose();
      ho_ImageG.Dispose();
      ho_ImageB.Dispose();
      ho_Region.Dispose();
      ho_pezregion.Dispose();
      ho_pezregions.Dispose();

      throw HDevExpDefaultException;
    }
  }

  // Short Description: Detect a fin 
  public void RC_optimar_preprocesar_imagenes (HObject ho_ImageOrg, HObject ho_ImagenRgbWhite, 
      HObject ho_ROI_0, out HObject ho_Image1, HTuple hv_CameraParameters, HTuple hv_CameraPose, 
      HTuple hv_angle_belt, HTuple hv_scale_x, HTuple hv_scale_y)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_ImageNirWhite=null, ho_Red=null;
    HObject ho_Green=null, ho_Blue=null, ho_ImageWorld=null;

    // Local copy input parameter variables 
    HObject ho_ROI_0_COPY_INP_TMP;
    ho_ROI_0_COPY_INP_TMP = ho_ROI_0.CopyObj(1,-1);



    // Local control variables 

    HTuple hv_Width = new HTuple(), hv_Height = new HTuple();
    HTuple hv_imagenTresCanales = new HTuple(), hv_Exception = null;
    HTuple hv_aux = new HTuple(), hv_offset = new HTuple();
    HTuple hv_offset_width = new HTuple(), hv_Row1 = new HTuple();
    HTuple hv_Column1 = new HTuple(), hv_Row2 = new HTuple();
    HTuple hv_Column2 = new HTuple();
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Image1);
    HOperatorSet.GenEmptyObj(out ho_ImageNirWhite);
    HOperatorSet.GenEmptyObj(out ho_Red);
    HOperatorSet.GenEmptyObj(out ho_Green);
    HOperatorSet.GenEmptyObj(out ho_Blue);
    HOperatorSet.GenEmptyObj(out ho_ImageWorld);
    try
    {
      //Parámetros de entrada:
      //  - ImageOrg
      //  - ImagenRgbWhite

      //Parámetros de salida:
      //  - Image
      //angulo alesund 0
      //angulo roboconcept -4

      try
      {
        //imagen del blanco para eliminar el defecto porducido por la iluminación
        ho_ImageNirWhite.Dispose();
        HOperatorSet.Rgb1ToGray(ho_ImagenRgbWhite, out ho_ImageNirWhite);

        //Read in the images and show them one-by-one.  Please not the fold-like
        //degradations running across the PCB.

        HOperatorSet.GetImageSize(ho_ImageOrg, out hv_Width, out hv_Height);
        hv_imagenTresCanales = 1;
        try
        {
          ho_Red.Dispose();ho_Green.Dispose();ho_Blue.Dispose();
          HOperatorSet.Decompose3(ho_ImageOrg, out ho_Red, out ho_Green, out ho_Blue
              );
        }
        // catch (Exception) 
        catch (HalconException HDevExpDefaultException2)
        {
          HDevExpDefaultException2.ToHTuple(out hv_Exception);
          hv_imagenTresCanales = 0;
        }


        //NIR or RGB correction
        if ((int)(new HTuple(hv_imagenTresCanales.TupleEqual(1))) != 0)
        {
          ho_Image1.Dispose();
          HOperatorSet.DivImage(ho_ImageOrg, ho_ImagenRgbWhite, out ho_Image1, 200, 
              0);
        }
        else
        {
          ho_Image1.Dispose();
          HOperatorSet.DivImage(ho_ImageOrg, ho_ImageNirWhite, out ho_Image1, 200, 
              0);
        }

        ho_ImageWorld.Dispose();
        parameters_image_to_world_plane_centered_full(ho_Image1, out ho_ImageWorld, 
            hv_CameraParameters, hv_CameraPose);
        //reescala para obtener resolucion 1:1
        ho_Image1.Dispose();
        HOperatorSet.ZoomImageFactor(ho_ImageWorld, out ho_Image1, hv_scale_x, hv_scale_y, 
            "constant");
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ZoomRegion(ho_ROI_0_COPY_INP_TMP, out ExpTmpOutVar_0, hv_scale_x, 
            hv_scale_y);
        ho_ROI_0_COPY_INP_TMP.Dispose();
        ho_ROI_0_COPY_INP_TMP = ExpTmpOutVar_0;
        }
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.RotateImage(ho_Image1, out ExpTmpOutVar_0, hv_angle_belt, "constant");
        ho_Image1.Dispose();
        ho_Image1 = ExpTmpOutVar_0;
        }



        //recortar imagen
        HOperatorSet.GetImageSize(ho_Image1, out hv_Width, out hv_Height);
        hv_aux = 180;
        hv_offset = hv_aux.Clone();
        hv_offset_width = 200;
        HOperatorSet.SmallestRectangle1(ho_ROI_0_COPY_INP_TMP, out hv_Row1, out hv_Column1, 
            out hv_Row2, out hv_Column2);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.CropRectangle1(ho_Image1, out ExpTmpOutVar_0, hv_Row1, hv_Column1, 
            hv_Row2, hv_Column2);
        ho_Image1.Dispose();
        ho_Image1 = ExpTmpOutVar_0;
        }

        //get_image_size (Image1, Width1, Height1)
        //desfase_RGB_NIR := 0
        //if (imagenTresCanales = 1)
          //crop_rectangle1 (Image1, Image1, desfase_RGB_NIR, 1, Height1, Width1)
        //else
          //crop_rectangle1 (Image1, Image1, 1, 1, Height1 - desfase_RGB_NIR, Width1)
        //endif
      }
      // catch (Exception) 
      catch (HalconException HDevExpDefaultException1)
      {
        HDevExpDefaultException1.ToHTuple(out hv_Exception);
      }


      ho_ROI_0_COPY_INP_TMP.Dispose();
      ho_ImageNirWhite.Dispose();
      ho_Red.Dispose();
      ho_Green.Dispose();
      ho_Blue.Dispose();
      ho_ImageWorld.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ROI_0_COPY_INP_TMP.Dispose();
      ho_ImageNirWhite.Dispose();
      ho_Red.Dispose();
      ho_Green.Dispose();
      ho_Blue.Dispose();
      ho_ImageWorld.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void SegmentImageHSV (HObject ho_Image, out HObject ho_Region)
  {



    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_ImageWorkingRGB=null, ho_RegionWorking;
    HObject ho_empty, ho_ImageLabIn=null, ho_Color_region2_verde;
    HObject ho_ImageLabOutArea, ho_Color_region=null, ho_regions;
    HObject ho_SelectedRegions1, ho_RegionDilation;

    // Local control variables 

    HTuple hv_Radius1 = null, hv_Radius2 = null;
    HTuple hv_Radius3 = null, hv_Center1 = null, hv_Center2 = null;
    HTuple hv_Center3 = null, hv_Radius = null, hv_Center = null;
    HTuple hv_distanciaMiniObj = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_Region);
    HOperatorSet.GenEmptyObj(out ho_ImageWorkingRGB);
    HOperatorSet.GenEmptyObj(out ho_RegionWorking);
    HOperatorSet.GenEmptyObj(out ho_empty);
    HOperatorSet.GenEmptyObj(out ho_ImageLabIn);
    HOperatorSet.GenEmptyObj(out ho_Color_region2_verde);
    HOperatorSet.GenEmptyObj(out ho_ImageLabOutArea);
    HOperatorSet.GenEmptyObj(out ho_Color_region);
    HOperatorSet.GenEmptyObj(out ho_regions);
    HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
    HOperatorSet.GenEmptyObj(out ho_RegionDilation);
    try
    {

      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ho_Image.CopyObj(1,-1);
      ho_RegionWorking.Dispose();
      HOperatorSet.GetDomain(ho_ImageWorkingRGB, out ho_RegionWorking);
      //busca los verdes
      hv_Radius1 = 6;
      hv_Radius2 = 6;
      hv_Radius3 = 10;
      //azul lab
      hv_Center1 = new HTuple();
      hv_Center1[0] = 2;
      hv_Center1[1] = -11;
      hv_Center2 = new HTuple();
      hv_Center2[0] = 3;
      hv_Center2[1] = -15;
      hv_Center3 = new HTuple();
      hv_Center3[0] = 5;
      hv_Center3[1] = -20;
      hv_Radius = new HTuple();
      hv_Radius = hv_Radius.TupleConcat(hv_Radius1);
      hv_Radius = hv_Radius.TupleConcat(hv_Radius2);
      hv_Radius = hv_Radius.TupleConcat(hv_Radius3);
      hv_Center = new HTuple();
      hv_Center = hv_Center.TupleConcat(hv_Center1);
      hv_Center = hv_Center.TupleConcat(hv_Center2);
      hv_Center = hv_Center.TupleConcat(hv_Center3);
      hv_distanciaMiniObj = 5;
      ho_empty.Dispose();
      HOperatorSet.GenEmptyObj(out ho_empty);
      ho_ImageLabIn.Dispose();
      ho_ImageLabIn = ho_empty.CopyObj(1,-1);
      ho_Color_region2_verde.Dispose();ho_ImageLabOutArea.Dispose();
      Color_region_extractor(ho_ImageWorkingRGB, ho_RegionWorking, ho_ImageLabIn, 
          out ho_Color_region2_verde, out ho_ImageLabOutArea, hv_Radius, hv_Center);
      ho_Color_region.Dispose();
      ho_Color_region = ho_Color_region2_verde.CopyObj(1,-1);
      ho_Region.Dispose();
      HOperatorSet.Difference(ho_RegionWorking, ho_Color_region, out ho_Region);
      ho_regions.Dispose();
      HOperatorSet.Connection(ho_Region, out ho_regions);
      ho_SelectedRegions1.Dispose();
      HOperatorSet.SelectShapeStd(ho_regions, out ho_SelectedRegions1, "max_area", 
          100);
      ho_RegionDilation.Dispose();
      HOperatorSet.DilationCircle(ho_SelectedRegions1, out ho_RegionDilation, 3.5);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.FillUp(ho_RegionDilation, out ExpTmpOutVar_0);
      ho_RegionDilation.Dispose();
      ho_RegionDilation = ExpTmpOutVar_0;
      }
      ho_Region.Dispose();
      HOperatorSet.ErosionCircle(ho_RegionDilation, out ho_Region, 4.5);






      ho_ImageWorkingRGB.Dispose();
      ho_RegionWorking.Dispose();
      ho_empty.Dispose();
      ho_ImageLabIn.Dispose();
      ho_Color_region2_verde.Dispose();
      ho_ImageLabOutArea.Dispose();
      ho_Color_region.Dispose();
      ho_regions.Dispose();
      ho_SelectedRegions1.Dispose();
      ho_RegionDilation.Dispose();

      return;

    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ImageWorkingRGB.Dispose();
      ho_RegionWorking.Dispose();
      ho_empty.Dispose();
      ho_ImageLabIn.Dispose();
      ho_Color_region2_verde.Dispose();
      ho_ImageLabOutArea.Dispose();
      ho_Color_region.Dispose();
      ho_regions.Dispose();
      ho_SelectedRegions1.Dispose();
      ho_RegionDilation.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void Tile_images_roboconcept (HObject ho_Images_concat, out HObject ho_ImagenMosaicking, 
      HTuple hv_offsetY, HTuple hv_offsetX, HTuple hv_correlated, out HTuple hv_error_mosaiking)
  {




    // Local iconic variables 

    HObject ho_ObjectSelected, ho_ObjectSelected1=null;
    HObject ho_ObjectSelected2=null, ho_Region1=null, ho_Region2=null;
    HObject ho_patronfindmin=null, ho_patron=null;

    // Local control variables 

    HTuple hv_countelements = null, hv_Width = null;
    HTuple hv_Height = null, hv_ancho = null, hv_salto = null;
    HTuple hv_zona_busqueda = null, hv_desplazy = null, hv_desplazx = null;
    HTuple hv_offset_heigth = null, hv_offset_Width = null;
    HTuple hv_defaultvect = null, hv_value_heigth = null, hv_value_Width = null;
    HTuple hv_value = null, hv_Index = new HTuple(), hv_newwidth = new HTuple();
    HTuple hv_newHeight = new HTuple(), hv_desplaza = new HTuple();
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_ImagenMosaicking);
    HOperatorSet.GenEmptyObj(out ho_ObjectSelected);
    HOperatorSet.GenEmptyObj(out ho_ObjectSelected1);
    HOperatorSet.GenEmptyObj(out ho_ObjectSelected2);
    HOperatorSet.GenEmptyObj(out ho_Region1);
    HOperatorSet.GenEmptyObj(out ho_Region2);
    HOperatorSet.GenEmptyObj(out ho_patronfindmin);
    HOperatorSet.GenEmptyObj(out ho_patron);
    try
    {
      HOperatorSet.CountObj(ho_Images_concat, out hv_countelements);
      ho_ObjectSelected.Dispose();
      HOperatorSet.SelectObj(ho_Images_concat, out ho_ObjectSelected, 1);
      HOperatorSet.GetImageSize(ho_ObjectSelected, out hv_Width, out hv_Height);

      hv_ancho = 10;
      hv_salto = 2;
      hv_zona_busqueda = hv_offsetY.Clone();
      hv_desplazy = hv_Height-hv_offsetY;
      hv_desplazx = hv_offsetX.Clone();
      HOperatorSet.CountObj(ho_Images_concat, out hv_countelements);
      hv_offset_heigth = 0;
      hv_offset_Width = 0;
      hv_defaultvect = -1;
      hv_value_heigth = 0;
      hv_value_Width = 0;
      hv_value = -1;


      if ((int)(new HTuple(hv_correlated.TupleEqual(0))) != 0)
      {

        HTuple end_val20 = hv_countelements;
        HTuple step_val20 = 1;
        for (hv_Index=2; hv_Index.Continue(end_val20, step_val20); hv_Index = hv_Index.TupleAdd(step_val20))
        {
          hv_value_heigth = hv_value_heigth+hv_desplazy;
          hv_value_Width = hv_value_Width+hv_desplazx;
          HOperatorSet.TupleConcat(hv_offset_heigth, hv_value_heigth, out hv_offset_heigth);
          HOperatorSet.TupleConcat(hv_offset_Width, hv_value_Width, out hv_offset_Width);
          HOperatorSet.TupleConcat(hv_defaultvect, hv_value, out hv_defaultvect);
        }

        hv_newwidth = hv_Width+(hv_offset_Width.TupleSelect(hv_countelements-1));
        hv_newHeight = hv_Height+(hv_offset_heigth.TupleSelect(hv_countelements-1));
      }
      else
      {

        //imagen a imagen comparando regiones
        HTuple end_val33 = hv_countelements;
        HTuple step_val33 = 1;
        for (hv_Index=2; hv_Index.Continue(end_val33, step_val33); hv_Index = hv_Index.TupleAdd(step_val33))
        {
          ho_ObjectSelected1.Dispose();
          HOperatorSet.SelectObj(ho_Images_concat, out ho_ObjectSelected1, hv_Index-1);
          ho_ObjectSelected2.Dispose();
          HOperatorSet.SelectObj(ho_Images_concat, out ho_ObjectSelected2, hv_Index);
          ho_Region1.Dispose();
          HOperatorSet.GetDomain(ho_ObjectSelected1, out ho_Region1);
          ho_Region2.Dispose();
          HOperatorSet.GetDomain(ho_ObjectSelected2, out ho_Region2);
          ho_patronfindmin.Dispose();ho_patron.Dispose();
          Calculo_desplazamineto_regiones(ho_Region2, ho_Region1, out ho_patronfindmin, 
              out ho_patron, hv_Height, hv_Width, hv_ancho, hv_zona_busqueda, hv_salto, 
              out hv_desplaza);
          hv_desplazy = hv_Height-hv_desplaza;
          hv_value_heigth = hv_value_heigth+hv_desplazy;
          hv_value_Width = hv_value_Width+hv_desplazx;
          HOperatorSet.TupleConcat(hv_offset_heigth, hv_value_heigth, out hv_offset_heigth);
          HOperatorSet.TupleConcat(hv_offset_Width, hv_value_Width, out hv_offset_Width);
          HOperatorSet.TupleConcat(hv_defaultvect, hv_value, out hv_defaultvect);
        }

        hv_newwidth = hv_Width+(hv_offset_Width.TupleSelect(hv_countelements-1));
        hv_newHeight = hv_Height+(hv_offset_heigth.TupleSelect(hv_countelements-1));

      }



      ho_ImagenMosaicking.Dispose();
      HOperatorSet.TileImagesOffset(ho_Images_concat, out ho_ImagenMosaicking, hv_offset_heigth, 
          hv_offset_Width, hv_defaultvect, hv_defaultvect, hv_defaultvect, hv_defaultvect, 
          hv_newwidth, hv_newHeight);
      hv_error_mosaiking = 0;
      ho_ObjectSelected.Dispose();
      ho_ObjectSelected1.Dispose();
      ho_ObjectSelected2.Dispose();
      ho_Region1.Dispose();
      ho_Region2.Dispose();
      ho_patronfindmin.Dispose();
      ho_patron.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ObjectSelected.Dispose();
      ho_ObjectSelected1.Dispose();
      ho_ObjectSelected2.Dispose();
      ho_Region1.Dispose();
      ho_Region2.Dispose();
      ho_patronfindmin.Dispose();
      ho_patron.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void decimar_imagen (HObject ho_ImagencolorconjuntoMala, out HObject ho_ImagencolorconjuntoMalareduced)
  {



    // Local iconic variables 

    HObject ho_ImageConverted, ho_ImageConvertedOut;

    // Local control variables 

    HTuple hv_Max = null, hv_Min = null, hv_MAX_Val = null;
    HTuple hv_mult = null, hv_add = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_ImagencolorconjuntoMalareduced);
    HOperatorSet.GenEmptyObj(out ho_ImageConverted);
    HOperatorSet.GenEmptyObj(out ho_ImageConvertedOut);
    try
    {
      ho_ImageConverted.Dispose();
      HOperatorSet.ConvertImageType(ho_ImagencolorconjuntoMala, out ho_ImageConverted, 
          "byte");
      //ESCALA LA IMAGEN PARA REDUCIR LA DIMENSIONALIDAD
      hv_Max = 255.0;
      hv_Min = 0.0;
      hv_MAX_Val = 16.0;
      HOperatorSet.TupleReal(hv_MAX_Val, out hv_MAX_Val);
      HOperatorSet.TupleReal(hv_Max, out hv_Max);
      HOperatorSet.TupleReal(hv_Min, out hv_Min);
      hv_mult = hv_MAX_Val/(hv_Max-hv_Min);
      hv_add = (-hv_mult)*hv_Min;
      ho_ImageConvertedOut.Dispose();
      HOperatorSet.ScaleImage(ho_ImageConverted, out ho_ImageConvertedOut, hv_mult, 
          hv_add);
      hv_mult = 1/hv_mult;
      ho_ImagencolorconjuntoMalareduced.Dispose();
      HOperatorSet.ScaleImage(ho_ImageConvertedOut, out ho_ImagencolorconjuntoMalareduced, 
          hv_mult, hv_add);
      //ImagencolorconjuntoMalareduced imagen con el numero de colores reducido MAX_Val^3
      ho_ImageConverted.Dispose();
      ho_ImageConvertedOut.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ImageConverted.Dispose();
      ho_ImageConvertedOut.Dispose();

      throw HDevExpDefaultException;
    }
  }

  // Short Description: Detect a fin 
  public void optimar_extraer_caracteristicas_Peces (HObject ho_ImagenRGB, HObject ho_ImagenNIR, 
      HTuple hv_ClassLUTHandle, HTuple hv_ParametrosCola)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_MascaraRGB, ho_MascaraNIR, ho_Gray;
    HObject ho_Matrix0Gray, ho_Matrix45Gray, ho_Matrix90Gray;
    HObject ho_Matrix135Gray, ho_R, ho_G, ho_B, ho_H, ho_S;
    HObject ho_V, ho_l, ho_a, ho_b, ho_ImageLab, ho_ImageWorkingRGB=null;
    HObject ho_MascaraWorking=null, ho_Imagenworking, ho_ImR;
    HObject ho_ImG, ho_ImB, ho_L, ho_ImageLAB, ho_ImageLabOut;
    HObject ho_HistogramOut, ho_Hist_domain, ho_HistogramOutlineal;
    HObject ho_Maxpos, ho_TiledImageRGB, ho_Imagencolorconjuntoreduced;
    HObject ho_ClassRegionsLUT, ho_totalRegionLUT, ho_ColorCuerpo;
    HObject ho_slectedobj=null, ho_Hue, ho_Saturation, ho_Intensity;
    HObject ho_Image1Median5, ho_ImagenFiltrada1, ho_Image1NIR;

    // Local control variables 

    HTuple hv_MeanGray = null, hv_DeviationGray = null;
    HTuple hv_GrayPlaneDeviation = null, hv_EntropyGray = null;
    HTuple hv_AnisotropyGray = null, hv_EntropyFuzzyGray = null;
    HTuple hv_PerimeterFuzzyGray = null, hv_Energy0gray = null;
    HTuple hv_Correlation0gray = null, hv_Homogeneity0gray = null;
    HTuple hv_Contrast0gray = null, hv_Energy45gray = null;
    HTuple hv_Correlation45gray = null, hv_Homogeneity45gray = null;
    HTuple hv_Contrast45gray = null, hv_Energy90gray = null;
    HTuple hv_Correlation90gray = null, hv_Homogeneity90gray = null;
    HTuple hv_Contrast90gray = null, hv_Energy135gray = null;
    HTuple hv_Correlation135gray = null, hv_Homogeneity135gray = null;
    HTuple hv_Contrast135gray = null, hv_MeanR = null, hv_DeviationR = null;
    HTuple hv_RPlaneDeviation = null, hv_EntropyR = null, hv_AnisotropyR = null;
    HTuple hv_EntropyFuzzyR = null, hv_PerimeterFuzzyR = null;
    HTuple hv_MeanG = null, hv_DeviationG = null, hv_GPlaneDeviation = null;
    HTuple hv_EntropyG = null, hv_AnisotropyG = null, hv_EntropyFuzzyG = null;
    HTuple hv_PerimeterFuzzyG = null, hv_MeanB = null, hv_DeviationB = null;
    HTuple hv_BPlaneDeviation = null, hv_EntropyB = null, hv_AnisotropyB = null;
    HTuple hv_EntropyFuzzyB = null, hv_PerimeterFuzzyB = null;
    HTuple hv_MeanH = null, hv_DeviationH = null, hv_HPlaneDeviation = null;
    HTuple hv_EntropyH = null, hv_AnisotropyH = null, hv_EntropyFuzzyH = null;
    HTuple hv_PerimeterFuzzyH = null, hv_MeanS = null, hv_DeviationS = null;
    HTuple hv_SPlaneDeviation = null, hv_EntropyS = null, hv_AnisotropyS = null;
    HTuple hv_EntropyFuzzyS = null, hv_PerimeterFuzzyS = null;
    HTuple hv_MeanV = null, hv_DeviationV = null, hv_VPlaneDeviation = null;
    HTuple hv_EntropyV = null, hv_AnisotropyV = null, hv_EntropyFuzzyV = null;
    HTuple hv_PerimeterFuzzyV = null, hv_Meanl = null, hv_Deviationl = null;
    HTuple hv_lPlaneDeviation = null, hv_Entropyl = null, hv_Anisotropyl = null;
    HTuple hv_EntropyFuzzyl = null, hv_PerimeterFuzzyl = null;
    HTuple hv_Meana = null, hv_Deviationa = null, hv_aPlaneDeviation = null;
    HTuple hv_Entropya = null, hv_Anisotropya = null, hv_EntropyFuzzya = null;
    HTuple hv_PerimeterFuzzya = null, hv_Meanb = null, hv_Deviationb = null;
    HTuple hv_bPlaneDeviation = null, hv_Entropyb = null, hv_Anisotropyb = null;
    HTuple hv_EntropyFuzzyb = null, hv_PerimeterFuzzyb = null;
    HTuple hv_Row = null, hv_Column = null, hv_Phi = null;
    HTuple hv_Largo = null, hv_Ancho = null, hv_Area = null;
    HTuple hv_Row1 = null, hv_Column3 = null, hv_Ra = null;
    HTuple hv_Rb = null, hv_Ra_Rb = null, hv_Circularity = null;
    HTuple hv_Compactness = null, hv_Distance = null, hv_Sigma = null;
    HTuple hv_Roundness = null, hv_Sides = null, hv_Convexity = null;
    HTuple hv_Rectangularity = null, hv_Anisometry = null;
    HTuple hv_Bulkiness = null, hv_StructureFactor = null;
    HTuple hv_PSI1 = null, hv_PSI2 = null, hv_PSI3 = null;
    HTuple hv_PSI4 = null, hv_M11 = null, hv_M20 = null, hv_M02 = null;
    HTuple hv_M21 = null, hv_M12 = null, hv_M03 = null, hv_M30 = null;
    HTuple hv_gaussSize = null, hv_MAX_Val = null, hv_Min = null;
    HTuple hv_Max = null, hv_Range = null, hv_area = null;
    HTuple hv_Max_x = null, hv_Max_y = null, hv_MRow = null;
    HTuple hv_MCol = null, hv_Alpha = null, hv_Beta = null;
    HTuple hv_Mean = null, hv_texto = null, hv_Index1 = null;
    HTuple hv_Index2 = new HTuple(), hv_textof = new HTuple();
    HTuple hv_Grayval = new HTuple(), hv_Trans = null, hv_TransInv = null;
    HTuple hv_MeanLab = null, hv_CovLab = null, hv_InfoPerComp = null;
    HTuple hv_num = null, hv_MeanL = null, hv_DevL = null;
    HTuple hv_Deva = null, hv_Devb = null, hv_AreaTotalLUT = null;
    HTuple hv_RowTotalLUT = null, hv_ColumnTotalLUT = null;
    HTuple hv_AreaLUT = null, hv_RowLUT = null, hv_ColumnLUT = null;
    HTuple hv_pattern_elements = null, hv_AreaCuerpo = null;
    HTuple hv_Columm = null, hv_IndicesCuerpo = null, hv_dimColores = null;
    HTuple hv_pos = new HTuple(), hv_Dev = new HTuple(), hv_HistogramGrayOut = null;
    HTuple hv_Function = null, hv_SmoothedFunction = null;
    HTuple hv_XValues = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_MascaraRGB);
    HOperatorSet.GenEmptyObj(out ho_MascaraNIR);
    HOperatorSet.GenEmptyObj(out ho_Gray);
    HOperatorSet.GenEmptyObj(out ho_Matrix0Gray);
    HOperatorSet.GenEmptyObj(out ho_Matrix45Gray);
    HOperatorSet.GenEmptyObj(out ho_Matrix90Gray);
    HOperatorSet.GenEmptyObj(out ho_Matrix135Gray);
    HOperatorSet.GenEmptyObj(out ho_R);
    HOperatorSet.GenEmptyObj(out ho_G);
    HOperatorSet.GenEmptyObj(out ho_B);
    HOperatorSet.GenEmptyObj(out ho_H);
    HOperatorSet.GenEmptyObj(out ho_S);
    HOperatorSet.GenEmptyObj(out ho_V);
    HOperatorSet.GenEmptyObj(out ho_l);
    HOperatorSet.GenEmptyObj(out ho_a);
    HOperatorSet.GenEmptyObj(out ho_b);
    HOperatorSet.GenEmptyObj(out ho_ImageLab);
    HOperatorSet.GenEmptyObj(out ho_ImageWorkingRGB);
    HOperatorSet.GenEmptyObj(out ho_MascaraWorking);
    HOperatorSet.GenEmptyObj(out ho_Imagenworking);
    HOperatorSet.GenEmptyObj(out ho_ImR);
    HOperatorSet.GenEmptyObj(out ho_ImG);
    HOperatorSet.GenEmptyObj(out ho_ImB);
    HOperatorSet.GenEmptyObj(out ho_L);
    HOperatorSet.GenEmptyObj(out ho_ImageLAB);
    HOperatorSet.GenEmptyObj(out ho_ImageLabOut);
    HOperatorSet.GenEmptyObj(out ho_HistogramOut);
    HOperatorSet.GenEmptyObj(out ho_Hist_domain);
    HOperatorSet.GenEmptyObj(out ho_HistogramOutlineal);
    HOperatorSet.GenEmptyObj(out ho_Maxpos);
    HOperatorSet.GenEmptyObj(out ho_TiledImageRGB);
    HOperatorSet.GenEmptyObj(out ho_Imagencolorconjuntoreduced);
    HOperatorSet.GenEmptyObj(out ho_ClassRegionsLUT);
    HOperatorSet.GenEmptyObj(out ho_totalRegionLUT);
    HOperatorSet.GenEmptyObj(out ho_ColorCuerpo);
    HOperatorSet.GenEmptyObj(out ho_slectedobj);
    HOperatorSet.GenEmptyObj(out ho_Hue);
    HOperatorSet.GenEmptyObj(out ho_Saturation);
    HOperatorSet.GenEmptyObj(out ho_Intensity);
    HOperatorSet.GenEmptyObj(out ho_Image1Median5);
    HOperatorSet.GenEmptyObj(out ho_ImagenFiltrada1);
    HOperatorSet.GenEmptyObj(out ho_Image1NIR);
    try
    {
      //  Parámetros de entrada:
      //    - ImagenRGB
      //    - ImagenNIR
      //
      //  Parámetros de salida:
      //    - message_queue
      //
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "ID", 0);

      //************************************************* MÁSCARAS **************************************************
      //*************************************************************************************************************
      ho_MascaraRGB.Dispose();
      HOperatorSet.Threshold(ho_ImagenRGB, out ho_MascaraRGB, 10, 255);
      ho_MascaraNIR.Dispose();
      HOperatorSet.Threshold(ho_ImagenNIR, out ho_MascaraNIR, 10, 255);

      //********************************************** NIVEL DE GRIS ************************************************
      //*************************************************************************************************************
      //Imagen escala de grises
      ho_Gray.Dispose();
      HOperatorSet.Rgb1ToGray(ho_ImagenRGB, out ho_Gray);
      //MeanGray,
      HOperatorSet.Intensity(ho_MascaraRGB, ho_Gray, out hv_MeanGray, out hv_DeviationGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanGray", hv_MeanGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationGray", hv_DeviationGray);
      //GrayPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_Gray, out hv_GrayPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "GrayPlaneDeviation", hv_GrayPlaneDeviation);
      //EntropyGray, AnisotropyGray
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_Gray, out hv_EntropyGray, out hv_AnisotropyGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyGray", hv_EntropyGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyGray", hv_AnisotropyGray);
      //EntropyFuzzyGray
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_Gray, 0, 255, out hv_EntropyFuzzyGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyGray", hv_EntropyFuzzyGray);
      //PerimeterFuzzyGray
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_Gray, 0, 255, out hv_PerimeterFuzzyGray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyGray", hv_PerimeterFuzzyGray);
      //Matriz de co-ocurrencia 0
      ho_Matrix0Gray.Dispose();
      HOperatorSet.GenCoocMatrix(ho_MascaraRGB, ho_Gray, out ho_Matrix0Gray, 6, 0);
      //Energy0gray, Correlation0gray, Homogeneity0gray, Contrast0gray
      HOperatorSet.CoocFeatureMatrix(ho_Matrix0Gray, out hv_Energy0gray, out hv_Correlation0gray, 
          out hv_Homogeneity0gray, out hv_Contrast0gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy0gray", hv_Energy0gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation0gray", hv_Correlation0gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity0gray", hv_Homogeneity0gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast0gray", hv_Contrast0gray);
      //Matriz de co-ocurrencia 45
      ho_Matrix45Gray.Dispose();
      HOperatorSet.GenCoocMatrix(ho_MascaraRGB, ho_Gray, out ho_Matrix45Gray, 6, 
          45);
      //Energy45gray, Correlation45gray, Homogeneity45gray, Contrast45gray
      HOperatorSet.CoocFeatureMatrix(ho_Matrix45Gray, out hv_Energy45gray, out hv_Correlation45gray, 
          out hv_Homogeneity45gray, out hv_Contrast45gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy45gray", hv_Energy45gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation45gray", hv_Correlation45gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity45gray", hv_Homogeneity45gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast45gray", hv_Contrast45gray);
      //Matriz de co-ocurrencia 90
      ho_Matrix90Gray.Dispose();
      HOperatorSet.GenCoocMatrix(ho_MascaraRGB, ho_Gray, out ho_Matrix90Gray, 6, 
          90);
      //Energy90gray, Correlation90gray, Homogeneity90gray, Contrast90gray
      HOperatorSet.CoocFeatureMatrix(ho_Matrix90Gray, out hv_Energy90gray, out hv_Correlation90gray, 
          out hv_Homogeneity90gray, out hv_Contrast90gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy90gray", hv_Energy90gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation90gray", hv_Correlation90gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity90gray", hv_Homogeneity90gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast90gray", hv_Contrast90gray);
      //Matriz de co-ocurrencia 135
      ho_Matrix135Gray.Dispose();
      HOperatorSet.GenCoocMatrix(ho_MascaraRGB, ho_Gray, out ho_Matrix135Gray, 6, 
          135);
      //Energy135gray, Correlation135gray, Homogeneity135gray, Contrast135gray
      HOperatorSet.CoocFeatureMatrix(ho_Matrix135Gray, out hv_Energy135gray, out hv_Correlation135gray, 
          out hv_Homogeneity135gray, out hv_Contrast135gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy135gray", hv_Energy135gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation135gray", hv_Correlation135gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity135gray", hv_Homogeneity135gray);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast135gray", hv_Contrast135gray);
      //*************************************************** RGB *****************************************************
      //*************************************************************************************************************
      //Canal R de la imagen RGB
      ho_R.Dispose();
      HOperatorSet.AccessChannel(ho_ImagenRGB, out ho_R, 1);
      //MeanR, DeviationR
      HOperatorSet.Intensity(ho_MascaraRGB, ho_R, out hv_MeanR, out hv_DeviationR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanR", hv_MeanR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationR", hv_DeviationR);
      //RPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_R, out hv_RPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "RPlaneDeviation", hv_RPlaneDeviation);
      //EntropyR, AnisotropyR
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_R, out hv_EntropyR, out hv_AnisotropyR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyR", hv_EntropyR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyR", hv_AnisotropyR);
      //EntropyFuzzyR
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_R, 0, 255, out hv_EntropyFuzzyR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyR", hv_EntropyFuzzyR);
      //PerimeterFuzzyR
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_R, 0, 255, out hv_PerimeterFuzzyR);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyR", hv_PerimeterFuzzyR);
      //Canal G de la imagen RGB
      ho_G.Dispose();
      HOperatorSet.AccessChannel(ho_ImagenRGB, out ho_G, 1);
      //MeanG, DeviationG
      HOperatorSet.Intensity(ho_MascaraRGB, ho_G, out hv_MeanG, out hv_DeviationG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanG", hv_MeanG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationG", hv_DeviationG);
      //GPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_G, out hv_GPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "GPlaneDeviation", hv_GPlaneDeviation);
      //EntropyG, AnisotropyG
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_G, out hv_EntropyG, out hv_AnisotropyG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyG", hv_EntropyG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyG", hv_AnisotropyG);
      //EntropyFuzzyG
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_G, 0, 255, out hv_EntropyFuzzyG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyG", hv_EntropyFuzzyG);
      //PerimeterFuzzyG
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_G, 0, 255, out hv_PerimeterFuzzyG);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyG", hv_PerimeterFuzzyG);
      //Canal B de la imagen RGB
      ho_B.Dispose();
      HOperatorSet.AccessChannel(ho_ImagenRGB, out ho_B, 3);
      //MeanB, DeviationB
      HOperatorSet.Intensity(ho_MascaraRGB, ho_B, out hv_MeanB, out hv_DeviationB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanB", hv_MeanB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationB", hv_DeviationB);
      //BPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_B, out hv_BPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "BPlaneDeviation", hv_BPlaneDeviation);
      //EntropyB, AnisotropyB
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_B, out hv_EntropyB, out hv_AnisotropyB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyB", hv_EntropyB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyB", hv_AnisotropyB);
      //EntropyFuzzyB
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_B, 0, 255, out hv_EntropyFuzzyB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyB", hv_EntropyFuzzyB);
      //PerimeterFuzzyB
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_B, 0, 255, out hv_PerimeterFuzzyB);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyB", hv_PerimeterFuzzyB);
      //*************************************************** HSV *****************************************************
      //*************************************************************************************************************
      //Imagen HSV
      ho_H.Dispose();ho_S.Dispose();ho_V.Dispose();
      HOperatorSet.TransFromRgb(ho_R, ho_G, ho_B, out ho_H, out ho_S, out ho_V, "hsv");
      //Canal H de la imagen HSV
      //MeanH, DeviationH
      HOperatorSet.Intensity(ho_MascaraRGB, ho_H, out hv_MeanH, out hv_DeviationH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanH", hv_MeanH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationH", hv_DeviationH);
      //HPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_H, out hv_HPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "HPlaneDeviation", hv_HPlaneDeviation);
      //EntropyH, AnisotropyH
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_H, out hv_EntropyH, out hv_AnisotropyH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyH", hv_EntropyH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyH", hv_AnisotropyH);
      //EntropyFuzzyH
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_H, 0, 255, out hv_EntropyFuzzyH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyH", hv_EntropyFuzzyH);
      //PerimeterFuzzyH
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_H, 0, 255, out hv_PerimeterFuzzyH);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyH", hv_PerimeterFuzzyH);
      //Canal S de la imagen HSV
      //MeanS, DeviationS
      HOperatorSet.Intensity(ho_MascaraRGB, ho_S, out hv_MeanS, out hv_DeviationS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanS", hv_MeanS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationS", hv_DeviationS);
      //SPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_S, out hv_SPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "SPlaneDeviation", hv_SPlaneDeviation);
      //EntropyS, AnisotropyS
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_S, out hv_EntropyS, out hv_AnisotropyS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyS", hv_EntropyS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyS", hv_AnisotropyS);
      //EntropyFuzzyS
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_S, 0, 255, out hv_EntropyFuzzyS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyS", hv_EntropyFuzzyS);
      //PerimeterFuzzyS
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_S, 0, 255, out hv_PerimeterFuzzyS);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyS", hv_PerimeterFuzzyS);
      //Canal V de la imagen HSV
      //MeanV, DeviationV
      HOperatorSet.Intensity(ho_MascaraRGB, ho_V, out hv_MeanV, out hv_DeviationV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanV", hv_MeanV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationV", hv_DeviationV);
      //VPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_V, out hv_VPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "VPlaneDeviation", hv_VPlaneDeviation);
      //EntropyV, AnisotropyV
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_V, out hv_EntropyV, out hv_AnisotropyV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyV", hv_EntropyV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyV", hv_AnisotropyV);
      //EntropyFuzzyV
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_V, 0, 255, out hv_EntropyFuzzyV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyV", hv_EntropyFuzzyV);
      //PerimeterFuzzyV
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_B, 0, 255, out hv_PerimeterFuzzyV);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyV", hv_PerimeterFuzzyV);
      //************************************************* CIElab ****************************************************
      //*************************************************************************************************************
      //Imagen CIElab
      ho_l.Dispose();ho_a.Dispose();ho_b.Dispose();
      HOperatorSet.TransFromRgb(ho_R, ho_G, ho_B, out ho_l, out ho_a, out ho_b, "cielab");
      //Canal l de la imagen CIElab
      //Meanl, Deviationl
      HOperatorSet.Intensity(ho_MascaraRGB, ho_l, out hv_Meanl, out hv_Deviationl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meanl", hv_Meanl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationl", hv_Deviationl);
      //lPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_l, out hv_lPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "lPlaneDeviation", hv_lPlaneDeviation);
      //Entropyl, Anisotropyl
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_l, out hv_Entropyl, out hv_Anisotropyl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropyl", hv_Entropyl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropyl", hv_Anisotropyl);
      //EntropyFuzzyl
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_l, 0, 255, out hv_EntropyFuzzyl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyl", hv_EntropyFuzzyl);
      //PerimeterFuzzyl
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_l, 0, 255, out hv_PerimeterFuzzyl);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyl", hv_PerimeterFuzzyl);

      //Canal a de la imagen CIElab
      //Meana, Deviationa
      HOperatorSet.Intensity(ho_MascaraRGB, ho_a, out hv_Meana, out hv_Deviationa);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meana", hv_Meana);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationa", hv_Deviationa);
      //aPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_a, out hv_aPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "aPlaneDeviation", hv_aPlaneDeviation);
      //Entropya, Anisotropya
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_a, out hv_Entropya, out hv_Anisotropya);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropya", hv_Entropya);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropya", hv_Anisotropya);
      //EntropyFuzzya
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_a, 0, 255, out hv_EntropyFuzzya);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzya", hv_EntropyFuzzya);
      //PerimeterFuzzya
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_a, 0, 255, out hv_PerimeterFuzzya);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzya", hv_PerimeterFuzzya);

      //Canal b de la imagen CIElab
      //Meanb, Deviationb
      HOperatorSet.Intensity(ho_MascaraRGB, ho_b, out hv_Meanb, out hv_Deviationb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meanb", hv_Meanb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationb", hv_Deviationb);
      //bPlaneDeviation
      HOperatorSet.PlaneDeviation(ho_MascaraRGB, ho_b, out hv_bPlaneDeviation);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "bPlaneDeviation", hv_bPlaneDeviation);
      //Entropyb, Anisotropyb
      HOperatorSet.EntropyGray(ho_MascaraRGB, ho_b, out hv_Entropyb, out hv_Anisotropyb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropyb", hv_Entropyb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropyb", hv_Anisotropyb);
      //EntropyFuzzyb
      HOperatorSet.FuzzyEntropy(ho_MascaraRGB, ho_b, 0, 255, out hv_EntropyFuzzyb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyb", hv_EntropyFuzzyb);
      //PerimeterFuzzyb
      HOperatorSet.FuzzyPerimeter(ho_MascaraRGB, ho_b, 0, 255, out hv_PerimeterFuzzyb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyb", hv_PerimeterFuzzyb);

      ho_ImageLab.Dispose();
      HOperatorSet.Compose3(ho_l, ho_a, ho_b, out ho_ImageLab);

      //************************************************ MORFOLOGÍA *************************************************
      //*************************************************************************************************************
      //Sacara la máscara del controno de la ImagenRBG (imagen sin fondo)
      //Largo, ancho
      HOperatorSet.SmallestRectangle2(ho_MascaraRGB, out hv_Row, out hv_Column, out hv_Phi, 
          out hv_Largo, out hv_Ancho);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Largo", hv_Largo);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Ancho", hv_Ancho);
      //Área
      HOperatorSet.AreaCenter(ho_MascaraRGB, out hv_Area, out hv_Row1, out hv_Column3);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Area", hv_Area);
      //Ra / Rb
      HOperatorSet.EllipticAxis(ho_MascaraRGB, out hv_Ra, out hv_Rb, out hv_Phi);
      HOperatorSet.TupleDiv(hv_Ra, hv_Rb, out hv_Ra_Rb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Ra_Rb", hv_Ra_Rb);
      //Circularity
      HOperatorSet.Circularity(ho_MascaraRGB, out hv_Circularity);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Circularity", hv_Circularity);
      //Compactness
      HOperatorSet.Compactness(ho_MascaraRGB, out hv_Compactness);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Compactness", hv_Compactness);
      //Roundness
      HOperatorSet.Roundness(ho_MascaraRGB, out hv_Distance, out hv_Sigma, out hv_Roundness, 
          out hv_Sides);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Roundness", hv_Roundness);
      //Convexity
      HOperatorSet.Convexity(ho_MascaraRGB, out hv_Convexity);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Convexity", hv_Convexity);
      //Rectangularity
      HOperatorSet.Rectangularity(ho_MascaraRGB, out hv_Rectangularity);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Rectangularity", hv_Rectangularity);
      //Anisometry, Bulkiness, StructureFactor
      HOperatorSet.Eccentricity(ho_MascaraRGB, out hv_Anisometry, out hv_Bulkiness, 
          out hv_StructureFactor);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisometry", hv_Anisometry);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Bulkiness", hv_Bulkiness);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "StructureFactor", hv_StructureFactor);
      //PSI1, PSI2, PSI3, PSI4
      HOperatorSet.MomentsRegionCentralInvar(ho_MascaraRGB, out hv_PSI1, out hv_PSI2, 
          out hv_PSI3, out hv_PSI4);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI1", hv_PSI1);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI2", hv_PSI2);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI3", hv_PSI3);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI4", hv_PSI4);
      //M11, M20, M02
      HOperatorSet.MomentsRegion2ndInvar(ho_MascaraRGB, out hv_M11, out hv_M20, out hv_M02);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M11", hv_M11);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M20", hv_M20);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M02", hv_M02);
      //M21, M12, M03, M30
      HOperatorSet.MomentsRegion3rdInvar(ho_MascaraRGB, out hv_M21, out hv_M12, out hv_M03, 
          out hv_M30);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M21", hv_M21);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M12", hv_M12);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M03", hv_M03);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M30", hv_M30);
      //************************************************ Histograma de color ab*************************************************
      //*************************************************************************************************************
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ho_ImagenRGB.CopyObj(1,-1);
      ho_MascaraWorking.Dispose();
      ho_MascaraWorking = ho_MascaraRGB.CopyObj(1,-1);
      ho_Imagenworking.Dispose();
      HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_MascaraWorking, out ho_Imagenworking
          );
      ho_ImR.Dispose();ho_ImG.Dispose();ho_ImB.Dispose();
      HOperatorSet.Decompose3(ho_Imagenworking, out ho_ImR, out ho_ImG, out ho_ImB
          );
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_ImR, out ExpTmpOutVar_0, "real");
      ho_ImR.Dispose();
      ho_ImR = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_ImG, out ExpTmpOutVar_0, "real");
      ho_ImG.Dispose();
      ho_ImG = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ConvertImageType(ho_ImB, out ExpTmpOutVar_0, "real");
      ho_ImB.Dispose();
      ho_ImB = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_ImR, out ExpTmpOutVar_0, 1/255.0, 0.0);
      ho_ImR.Dispose();
      ho_ImR = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_ImG, out ExpTmpOutVar_0, 1/255.0, 0.0);
      ho_ImG.Dispose();
      ho_ImG = ExpTmpOutVar_0;
      }
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ScaleImage(ho_ImB, out ExpTmpOutVar_0, 1/255.0, 0.0);
      ho_ImB.Dispose();
      ho_ImB = ExpTmpOutVar_0;
      }
      ho_L.Dispose();ho_a.Dispose();ho_b.Dispose();
      HOperatorSet.TransFromRgb(ho_ImR, ho_ImG, ho_ImB, out ho_L, out ho_a, out ho_b, 
          "cielab");
      ho_ImageLAB.Dispose();
      HOperatorSet.Compose3(ho_L, ho_a, ho_b, out ho_ImageLAB);
      //funcion para el calculo del histograma de color ab
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_MascaraWorking, out ExpTmpOutVar_0
          );
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ExpTmpOutVar_0;
      }
      hv_gaussSize = 0.2;
      hv_MAX_Val = 20.0;
      ho_ImageLabOut.Dispose();
      HOperatorSet.GenEmptyObj(out ho_ImageLabOut);

      ho_HistogramOut.Dispose();
      Histo_ab_generator(ho_ImageWorkingRGB, ho_MascaraWorking, ho_ImageLAB, out ho_HistogramOut, 
          hv_gaussSize, hv_MAX_Val);
      ho_Hist_domain.Dispose();
      HOperatorSet.GenRectangle1(out ho_Hist_domain, 0, 0, hv_MAX_Val, hv_MAX_Val);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_HistogramOut, ho_Hist_domain, out ExpTmpOutVar_0
          );
      ho_HistogramOut.Dispose();
      ho_HistogramOut = ExpTmpOutVar_0;
      }
      ho_HistogramOutlineal.Dispose();
      HOperatorSet.CropDomain(ho_HistogramOut, out ho_HistogramOutlineal);

      HOperatorSet.MinMaxGray(ho_HistogramOut, ho_HistogramOut, 0, out hv_Min, out hv_Max, 
          out hv_Range);
      ho_Maxpos.Dispose();
      HOperatorSet.Threshold(ho_HistogramOut, out ho_Maxpos, hv_Max, hv_Max);
      HOperatorSet.AreaCenter(ho_Maxpos, out hv_area, out hv_Max_x, out hv_Max_y);
      HOperatorSet.MomentsGrayPlane(ho_HistogramOut, ho_HistogramOut, out hv_MRow, 
          out hv_MCol, out hv_Alpha, out hv_Beta, out hv_Mean);


      hv_texto = "COLOR_Histo_ab_";
      HTuple end_val330 = hv_MAX_Val-1;
      HTuple step_val330 = 1;
      for (hv_Index1=0; hv_Index1.Continue(end_val330, step_val330); hv_Index1 = hv_Index1.TupleAdd(step_val330))
      {
        HTuple end_val331 = hv_MAX_Val-1;
        HTuple step_val331 = 1;
        for (hv_Index2=0; hv_Index2.Continue(end_val331, step_val331); hv_Index2 = hv_Index2.TupleAdd(step_val331))
        {
          hv_textof = ((hv_texto+hv_Index1)+"_")+hv_Index2;
          HOperatorSet.GetGrayval(ho_HistogramOut, hv_Index1, hv_Index2, out hv_Grayval);
          HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_Grayval);
        }
      }
      hv_texto = "COLOR_Histo_ab_max_X";
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, hv_Max_x);
      hv_texto = "COLOR_Histo_ab_max_Y";
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, hv_Max_y);
      hv_texto = "COLOR_Histo_ab_Dev_X";
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, hv_MCol);
      hv_texto = "COLOR_Histo_ab_Dev_Y";
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, hv_MRow);
      //************************************  Color LAB **************************************
      //*************************************************************************************************************
      //Parametros color RGB Cuerpo
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ho_ImagenRGB.CopyObj(1,-1);
      ho_MascaraWorking.Dispose();
      ho_MascaraWorking = ho_MascaraRGB.CopyObj(1,-1);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_MascaraRGB, out ExpTmpOutVar_0
          );
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ExpTmpOutVar_0;
      }
      //calcula los parametros PCA de la imagen y mascara asignados
      Calcula_PCA_lab_params(ho_ImageWorkingRGB, ho_MascaraWorking, ho_ImageLAB, 
          out hv_Trans, out hv_TransInv, out hv_MeanLab, out hv_CovLab, out hv_InfoPerComp);
      hv_num = new HTuple(hv_TransInv.TupleLength());
      if ((int)(new HTuple(hv_num.TupleEqual(0))) != 0)
      {
        hv_TransInv = new HTuple();
        hv_TransInv[0] = 0;
        hv_TransInv[1] = 0;
        hv_TransInv[2] = 0;
        hv_TransInv[3] = 0;
        hv_TransInv[4] = 0;
        hv_TransInv[5] = 0;
        hv_TransInv[6] = 0;
        hv_TransInv[7] = 0;
        hv_TransInv[8] = 0;
        hv_TransInv[9] = 0;
        hv_TransInv[10] = 0;
        hv_TransInv[11] = 0;
      }
      hv_MeanL = hv_MeanLab.TupleSelect(0);
      hv_Meana = hv_MeanLab.TupleSelect(1);
      hv_Meanb = hv_MeanLab.TupleSelect(2);
      hv_DevL = ((hv_CovLab.TupleSelect(0))).TupleSqrt();
      hv_Deva = ((hv_CovLab.TupleSelect(4))).TupleSqrt();
      hv_Devb = ((hv_CovLab.TupleSelect(8))).TupleSqrt();

      //parametros de color medias y desviaciones
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_L", 
          hv_MeanL);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_a", 
          hv_Meana);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_b", 
          hv_Meanb);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_L", 
          hv_DevL);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_a", 
          hv_Deva);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_b", 
          hv_Devb);
      //vector Y
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_1", 
          hv_TransInv.TupleSelect(0));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_2", 
          hv_TransInv.TupleSelect(4));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_3", 
          hv_TransInv.TupleSelect(8));
      //vector Y
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_1", 
          hv_TransInv.TupleSelect(1));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_2", 
          hv_TransInv.TupleSelect(5));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_3", 
          hv_TransInv.TupleSelect(9));
      //vector Z
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_1", 
          hv_TransInv.TupleSelect(2));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_2", 
          hv_TransInv.TupleSelect(6));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_3", 
          hv_TransInv.TupleSelect(10));
      //origen de coordenadas
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_1", 
          hv_TransInv.TupleSelect(3));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_2", 
          hv_TransInv.TupleSelect(7));
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_3", 
          hv_TransInv.TupleSelect(11));


      //***********************************************SEGMENTACION COLOR********************************************
      //**************************************************************************************************
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ho_ImagenRGB.CopyObj(1,-1);
      ho_MascaraWorking.Dispose();
      ho_MascaraWorking = ho_MascaraRGB.CopyObj(1,-1);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ReduceDomain(ho_ImageWorkingRGB, ho_MascaraRGB, out ExpTmpOutVar_0
          );
      ho_ImageWorkingRGB.Dispose();
      ho_ImageWorkingRGB = ExpTmpOutVar_0;
      }
      ho_TiledImageRGB.Dispose();
      HOperatorSet.MedianImage(ho_ImageWorkingRGB, out ho_TiledImageRGB, "circle", 
          2, "mirrored");
      ho_Imagencolorconjuntoreduced.Dispose();
      decimar_imagen(ho_TiledImageRGB, out ho_Imagencolorconjuntoreduced);
      ho_ClassRegionsLUT.Dispose();
      HOperatorSet.ClassifyImageClassLut(ho_Imagencolorconjuntoreduced, out ho_ClassRegionsLUT, 
          hv_ClassLUTHandle);

      ho_totalRegionLUT.Dispose();
      HOperatorSet.GetDomain(ho_TiledImageRGB, out ho_totalRegionLUT);
      HOperatorSet.AreaCenter(ho_totalRegionLUT, out hv_AreaTotalLUT, out hv_RowTotalLUT, 
          out hv_ColumnTotalLUT);
      HOperatorSet.AreaCenter(ho_ClassRegionsLUT, out hv_AreaLUT, out hv_RowLUT, 
          out hv_ColumnLUT);
      HOperatorSet.TupleReal(hv_AreaLUT, out hv_AreaLUT);
      HOperatorSet.TupleReal(hv_AreaTotalLUT, out hv_AreaTotalLUT);

      hv_AreaLUT = (100*hv_AreaLUT)/hv_AreaTotalLUT;
      hv_texto = "Patt_Dist";
      HOperatorSet.CountObj(ho_ClassRegionsLUT, out hv_pattern_elements);
      HTuple end_val407 = hv_pattern_elements;
      HTuple step_val407 = 1;
      for (hv_Index1=1; hv_Index1.Continue(end_val407, step_val407); hv_Index1 = hv_Index1.TupleAdd(step_val407))
      {
        hv_textof = (hv_texto+"_")+hv_Index1;
        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_AreaLUT.TupleSelect(
            hv_Index1-1));
      }

      //color mayoritario cuerpo area
      HOperatorSet.AreaCenter(ho_ClassRegionsLUT, out hv_AreaCuerpo, out hv_Row, 
          out hv_Columm);
      //genero una region con los tres colores mayoritarios
      ho_ColorCuerpo.Dispose();
      HOperatorSet.GenEmptyObj(out ho_ColorCuerpo);
      HOperatorSet.TupleSortIndex(hv_AreaCuerpo, out hv_IndicesCuerpo);
      hv_dimColores = new HTuple(hv_AreaCuerpo.TupleLength());
      HTuple end_val418 = hv_dimColores;
      HTuple step_val418 = 1;
      for (hv_Index1=1; hv_Index1.Continue(end_val418, step_val418); hv_Index1 = hv_Index1.TupleAdd(step_val418))
      {
        hv_pos = hv_IndicesCuerpo.TupleSelect(hv_dimColores-hv_Index1);
        ho_slectedobj.Dispose();
        HOperatorSet.SelectObj(ho_ClassRegionsLUT, out ho_slectedobj, hv_pos+1);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ConcatObj(ho_ColorCuerpo, ho_slectedobj, out ExpTmpOutVar_0);
        ho_ColorCuerpo.Dispose();
        ho_ColorCuerpo = ExpTmpOutVar_0;
        }
      }
      //region_to_mean (ClassRegionsLUT, Imagencolorconjuntoreduced, ImageMean)
      ho_Hue.Dispose();ho_Saturation.Dispose();ho_Intensity.Dispose();
      HOperatorSet.Decompose3(ho_ImageLAB, out ho_Hue, out ho_Saturation, out ho_Intensity
          );
      //escribe los colores en orden de la tabla
      hv_texto = "Color";
      hv_dimColores = new HTuple(hv_AreaCuerpo.TupleLength());
      HTuple end_val428 = hv_dimColores;
      HTuple step_val428 = 1;
      for (hv_Index1=1; hv_Index1.Continue(end_val428, step_val428); hv_Index1 = hv_Index1.TupleAdd(step_val428))
      {
        //si se quiere por orden descendente ColorCuerpo
        ho_slectedobj.Dispose();
        HOperatorSet.SelectObj(ho_ColorCuerpo, out ho_slectedobj, hv_Index1);
        HOperatorSet.Intensity(ho_slectedobj, ho_Hue, out hv_MeanH, out hv_Dev);
        HOperatorSet.Intensity(ho_slectedobj, ho_Saturation, out hv_MeanS, out hv_Dev);
        HOperatorSet.Intensity(ho_slectedobj, ho_Intensity, out hv_MeanV, out hv_Dev);
        HOperatorSet.TupleReal(hv_MeanH, out hv_MeanH);
        HOperatorSet.TupleReal(hv_MeanS, out hv_MeanS);
        HOperatorSet.TupleReal(hv_MeanV, out hv_MeanV);
        hv_textof = (hv_texto+"_Media_L_")+hv_Index1;
        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_MeanH);
        hv_textof = (hv_texto+"_Media_a_")+hv_Index1;
        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_MeanS);
        hv_textof = (hv_texto+"_Media_b_")+hv_Index1;
        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_MeanV);


      }


      //*****************************************TEXTURA*************************************************
      //*********************************************************************************************
      ho_Image1Median5.Dispose();
      HOperatorSet.MedianImage(ho_ImagenNIR, out ho_Image1Median5, "circle", 2, "mirrored");
      ho_ImagenFiltrada1.Dispose();
      Difuminado_rapido_gauss(ho_Image1Median5, ho_MascaraNIR, out ho_ImagenFiltrada1, 
          10, 6);
      ho_Image1NIR.Dispose();
      HOperatorSet.DivImage(ho_Image1Median5, ho_ImagenFiltrada1, out ho_Image1NIR, 
          124, 0);
      Histo_gray_generator(ho_Image1NIR, ho_MascaraNIR, 100, out hv_HistogramGrayOut);
      HOperatorSet.CreateFunct1dArray(hv_HistogramGrayOut, out hv_Function);
      HOperatorSet.SmoothFunct1dGauss(hv_Function, 1, out hv_SmoothedFunction);
      HOperatorSet.Funct1dToPairs(hv_SmoothedFunction, out hv_XValues, out hv_HistogramGrayOut);

      //mensajes Histogramas color
      hv_texto = "TEXTURA_Histo";
      for (hv_Index1=0; (int)hv_Index1<=(int)(100-1); hv_Index1 = (int)hv_Index1 + 1)
      {
        hv_textof = (hv_texto+"_")+hv_Index1;
        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, hv_HistogramGrayOut.TupleSelect(
            hv_Index1));
      }


      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_1", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_2", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_3", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_4", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_5", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_1", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_2", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_3", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_4", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_5", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_ponderada", 
          0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada", 0);
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_Forzada", 0);

      ho_MascaraRGB.Dispose();
      ho_MascaraNIR.Dispose();
      ho_Gray.Dispose();
      ho_Matrix0Gray.Dispose();
      ho_Matrix45Gray.Dispose();
      ho_Matrix90Gray.Dispose();
      ho_Matrix135Gray.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_H.Dispose();
      ho_S.Dispose();
      ho_V.Dispose();
      ho_l.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLab.Dispose();
      ho_ImageWorkingRGB.Dispose();
      ho_MascaraWorking.Dispose();
      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_ImageLAB.Dispose();
      ho_ImageLabOut.Dispose();
      ho_HistogramOut.Dispose();
      ho_Hist_domain.Dispose();
      ho_HistogramOutlineal.Dispose();
      ho_Maxpos.Dispose();
      ho_TiledImageRGB.Dispose();
      ho_Imagencolorconjuntoreduced.Dispose();
      ho_ClassRegionsLUT.Dispose();
      ho_totalRegionLUT.Dispose();
      ho_ColorCuerpo.Dispose();
      ho_slectedobj.Dispose();
      ho_Hue.Dispose();
      ho_Saturation.Dispose();
      ho_Intensity.Dispose();
      ho_Image1Median5.Dispose();
      ho_ImagenFiltrada1.Dispose();
      ho_Image1NIR.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_MascaraRGB.Dispose();
      ho_MascaraNIR.Dispose();
      ho_Gray.Dispose();
      ho_Matrix0Gray.Dispose();
      ho_Matrix45Gray.Dispose();
      ho_Matrix90Gray.Dispose();
      ho_Matrix135Gray.Dispose();
      ho_R.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_H.Dispose();
      ho_S.Dispose();
      ho_V.Dispose();
      ho_l.Dispose();
      ho_a.Dispose();
      ho_b.Dispose();
      ho_ImageLab.Dispose();
      ho_ImageWorkingRGB.Dispose();
      ho_MascaraWorking.Dispose();
      ho_Imagenworking.Dispose();
      ho_ImR.Dispose();
      ho_ImG.Dispose();
      ho_ImB.Dispose();
      ho_L.Dispose();
      ho_ImageLAB.Dispose();
      ho_ImageLabOut.Dispose();
      ho_HistogramOut.Dispose();
      ho_Hist_domain.Dispose();
      ho_HistogramOutlineal.Dispose();
      ho_Maxpos.Dispose();
      ho_TiledImageRGB.Dispose();
      ho_Imagencolorconjuntoreduced.Dispose();
      ho_ClassRegionsLUT.Dispose();
      ho_totalRegionLUT.Dispose();
      ho_ColorCuerpo.Dispose();
      ho_slectedobj.Dispose();
      ho_Hue.Dispose();
      ho_Saturation.Dispose();
      ho_Intensity.Dispose();
      ho_Image1Median5.Dispose();
      ho_ImagenFiltrada1.Dispose();
      ho_Image1NIR.Dispose();

      throw HDevExpDefaultException;
    }
  }

  // Short Description: Detect a fin 
  public void optimar_extraer_caracteristicas_Peces_null (HTuple hv_ParametrosCola)
  {



    // Local iconic variables 

    // Local control variables 

    HTuple hv_MAX_Val = null, hv_texto = null;
    HTuple hv_Index1 = null, hv_Index2 = new HTuple(), hv_textof = new HTuple();
    HTuple hv_num = null, hv_TransInv = new HTuple(), hv_MeanL = null;
    HTuple hv_Meana = null, hv_Meanb = null, hv_DevL = null;
    HTuple hv_Deva = null, hv_Devb = null, hv_dimColores = null;
    // Initialize local and output iconic variables 
    //  Parámetros de entrada:
    //    - ImagenRGB
    //    - ImagenNIR
    //
    //  Parámetros de salida:
    //    - message_queue
    //

    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "ID", 1);
    //********************************************** NIVEL DE GRIS ************************************************
    //*************************************************************************************************************
    //MeanGray,
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "GrayPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyGray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy0gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation0gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity0gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast0gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy45gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation45gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity45gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast45gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy90gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation90gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity90gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast90gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Energy135gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Correlation135gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Homogeneity135gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Contrast135gray", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "RPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyR", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanG", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationG", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "GPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyG", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyG", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyG", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyG", 0);


    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanB", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationB", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "BPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyB", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyB", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyB", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyB", 0);



    //*************************************************** HSV *****************************************************
    //*************************************************************************************************************
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "HPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyH", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "SPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyS", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "MeanV", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "DeviationV", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "VPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyV", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "AnisotropyV", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyV", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyV", 0);



    //************************************************* CIElab ****************************************************
    //*************************************************************************************************************
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meanl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "lPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropyl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropyl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyl", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meana", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationa", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "aPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropya", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropya", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzya", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzya", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Meanb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Deviationb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "bPlaneDeviation", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Entropyb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisotropyb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "EntropyFuzzyb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PerimeterFuzzyb", 0);
    //************************************************ MORFOLOGÍA *************************************************
    //*************************************************************************************************************
    //Sacara la máscara del controno de la ImagenRBG (imagen sin fondo)
    //Largo, ancho
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Largo", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Ancho", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Area", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Ra_Rb", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Circularity", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Compactness", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Roundness", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Convexity", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Rectangularity", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Anisometry", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Bulkiness", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "StructureFactor", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI1", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI2", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI3", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "PSI4", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M11", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M20", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M02", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M21", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M12", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M03", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "M30", 0);
    //************************************************ Histograma de color ab*************************************************
    //*************************************************************************************************************
    hv_MAX_Val = 20.0;
    hv_texto = "COLOR_Histo_ab_";
    HTuple end_val141 = hv_MAX_Val-1;
    HTuple step_val141 = 1;
    for (hv_Index1=0; hv_Index1.Continue(end_val141, step_val141); hv_Index1 = hv_Index1.TupleAdd(step_val141))
    {
      HTuple end_val142 = hv_MAX_Val-1;
      HTuple step_val142 = 1;
      for (hv_Index2=0; hv_Index2.Continue(end_val142, step_val142); hv_Index2 = hv_Index2.TupleAdd(step_val142))
      {
        hv_textof = ((hv_texto+hv_Index1)+"_")+hv_Index2;

        HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);
      }
    }



    hv_texto = "COLOR_Histo_ab_max_X";
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, 0);
    hv_texto = "COLOR_Histo_ab_max_Y";
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, 0);
    hv_texto = "COLOR_Histo_ab_Dev_X";
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, 0);
    hv_texto = "COLOR_Histo_ab_Dev_Y";
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_texto, 0);

    //************************************  Color LAB **************************************
    //*************************************************************************************************************

    hv_num = 0;
    if ((int)(new HTuple(hv_num.TupleEqual(0))) != 0)
    {
      hv_TransInv = new HTuple();
      hv_TransInv[0] = 0;
      hv_TransInv[1] = 0;
      hv_TransInv[2] = 0;
      hv_TransInv[3] = 0;
      hv_TransInv[4] = 0;
      hv_TransInv[5] = 0;
      hv_TransInv[6] = 0;
      hv_TransInv[7] = 0;
      hv_TransInv[8] = 0;
      hv_TransInv[9] = 0;
      hv_TransInv[10] = 0;
      hv_TransInv[11] = 0;
    }
    hv_MeanL = 0;
    hv_Meana = 0;
    hv_Meanb = 0;
    hv_DevL = 0;
    hv_Deva = 0;
    hv_Devb = 0;

    //parametros de color medias y desviaciones
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_L", 
        hv_MeanL);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_a", 
        hv_Meana);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Mean_cuerpo_lineal_b", 
        hv_Meanb);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_L", 
        hv_DevL);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_a", 
        hv_Deva);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_Dev_cuerpo_lineal_b", 
        hv_Devb);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_1", 
        hv_TransInv.TupleSelect(0));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_2", 
        hv_TransInv.TupleSelect(4));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_X_3", 
        hv_TransInv.TupleSelect(8));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_1", 
        hv_TransInv.TupleSelect(1));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_2", 
        hv_TransInv.TupleSelect(5));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Y_3", 
        hv_TransInv.TupleSelect(9));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_1", 
        hv_TransInv.TupleSelect(2));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_2", 
        hv_TransInv.TupleSelect(6));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_Z_3", 
        hv_TransInv.TupleSelect(10));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_1", 
        hv_TransInv.TupleSelect(3));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_2", 
        hv_TransInv.TupleSelect(7));
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "COLOR_PCA_cuerpo_lineal_lab_O_3", 
        hv_TransInv.TupleSelect(11));

    //***********************************************SEGMENTACION COLOR********************************************
    //**************************************************************************************************

    hv_texto = "Patt_Dist";

    for (hv_Index1=1; (int)hv_Index1<=88; hv_Index1 = (int)hv_Index1 + 1)
    {
      hv_textof = (hv_texto+"_")+hv_Index1;
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);
    }

    //c
    hv_texto = "Color";
    hv_dimColores = 88;
    HTuple end_val207 = hv_dimColores;
    HTuple step_val207 = 1;
    for (hv_Index1=1; hv_Index1.Continue(end_val207, step_val207); hv_Index1 = hv_Index1.TupleAdd(step_val207))
    {

      hv_textof = (hv_texto+"_Media_L_")+hv_Index1;
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);
      hv_textof = (hv_texto+"_Media_a_")+hv_Index1;
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);
      hv_textof = (hv_texto+"_Media_b_")+hv_Index1;
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);

    }
    //*****************************************TEXTURA*************************************************
    //*********************************************************************************************


    //mensajes Histogramas color
    hv_texto = "TEXTURA_Histo";
    for (hv_Index1=0; (int)hv_Index1<=(int)(100-1); hv_Index1 = (int)hv_Index1 + 1)
    {
      hv_textof = (hv_texto+"_")+hv_Index1;
      HOperatorSet.SetMessageTuple(hv_ParametrosCola, hv_textof, 0);
    }

    //**************************************************************************************************
    //**************************************************************************************************


    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_1", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_2", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_3", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_4", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_pertenencia_5", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_1", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_2", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_3", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_4", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_5", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada_ponderada", 
        0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_asignada", 0);
    HOperatorSet.SetMessageTuple(hv_ParametrosCola, "Categoria_Forzada", 0);




    return;
  }

  // Short Description: Detect a fin 
  public void optimar_mosaiking_imagenes (HObject ho_ImagenIni_NIR, HObject ho_ImagenFin_NIR, 
      HObject ho_ImagenMos_NIR, out HObject ho_ImagenMosaicking_NIR, HTuple hv_diff_row_0, 
      HTuple hv_diff_col_0, out HTuple hv_diff_row0, out HTuple hv_diff_col0, out HTuple hv_error_mosaiking)
  {




    // Stack for temporary objects 
    HObject[] OTemp = new HObject[20];

    // Local iconic variables 

    HObject ho_R0=null, ho_G=null, ho_B=null, ho_R1=null;
    HObject ho_ImagenMosIni=null, ho_ImagenFin_real=null, ho_ImagenIni_real=null;
    HObject ho_Mascara=null, ho_ConnectedRegions=null, ho_SelectedRegions=null;
    HObject ho_Mascara0=null, ho_SelectedRegions0=null, ho_Mascara2=null;
    HObject ho_SelectedRegions1=null, ho_Domain, ho_ImageEquHisto;
    HObject ho_Img1, ho_Rectangle1, ho_RegionIntersection, ho_Rectangle=null;
    HObject ho_ImageReduced=null, ho_ImagenMosFin_NIR=null;
    HObject ho_ImageEquHisto2_NIR=null, ho_ImageReduced1_NIR=null;
    HObject ho_Images=null, ho_Images_NIR=null, ho_TiledImageOriginal_NIR=null;
    HObject ho_Region=null, ho_ImagenMosaickingAux_NIR=null;
    HObject ho_ImageFFT=null, ho_ImageFFT2=null, ho_ImageCorrelation=null;
    HObject ho_ImageFFTInv=null;

    // Local copy input parameter variables 
    HObject ho_ImagenFin_NIR_COPY_INP_TMP;
    ho_ImagenFin_NIR_COPY_INP_TMP = ho_ImagenFin_NIR.CopyObj(1,-1);



    // Local control variables 

    HTuple hv_factor = null, hv_escala = null;
    HTuple hv_imagenRGB = null, hv_Exception = null, hv_Width = null;
    HTuple hv_Height = null, hv_W = null, hv_H = null, hv_Width1 = null;
    HTuple hv_Height1 = null, hv_Area = null, hv_Row3 = null;
    HTuple hv_Column3 = null, hv_Row11 = new HTuple(), hv_Column11 = new HTuple();
    HTuple hv_Row2 = new HTuple(), hv_Column21 = new HTuple();
    HTuple hv_Row = new HTuple(), hv_Column = new HTuple();
    HTuple hv_Phi = new HTuple(), hv_Length2 = new HTuple();
    HTuple hv_Length1 = new HTuple(), hv_TemplateID = new HTuple();
    HTuple hv_Angle = new HTuple(), hv_TemplH2 = new HTuple();
    HTuple hv_TemplW2 = new HTuple(), hv_TemplPhi = new HTuple();
    HTuple hv_max_error = new HTuple(), hv_Row1 = new HTuple();
    HTuple hv_Column1 = new HTuple(), hv_Error = new HTuple();
    HTuple hv_res = new HTuple(), hv_diff_row = new HTuple();
    HTuple hv_diff_col = new HTuple(), hv_Fila1 = new HTuple();
    HTuple hv_Fila2 = new HTuple(), hv_Column2 = new HTuple();
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_ImagenMosaicking_NIR);
    HOperatorSet.GenEmptyObj(out ho_R0);
    HOperatorSet.GenEmptyObj(out ho_G);
    HOperatorSet.GenEmptyObj(out ho_B);
    HOperatorSet.GenEmptyObj(out ho_R1);
    HOperatorSet.GenEmptyObj(out ho_ImagenMosIni);
    HOperatorSet.GenEmptyObj(out ho_ImagenFin_real);
    HOperatorSet.GenEmptyObj(out ho_ImagenIni_real);
    HOperatorSet.GenEmptyObj(out ho_Mascara);
    HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
    HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
    HOperatorSet.GenEmptyObj(out ho_Mascara0);
    HOperatorSet.GenEmptyObj(out ho_SelectedRegions0);
    HOperatorSet.GenEmptyObj(out ho_Mascara2);
    HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
    HOperatorSet.GenEmptyObj(out ho_Domain);
    HOperatorSet.GenEmptyObj(out ho_ImageEquHisto);
    HOperatorSet.GenEmptyObj(out ho_Img1);
    HOperatorSet.GenEmptyObj(out ho_Rectangle1);
    HOperatorSet.GenEmptyObj(out ho_RegionIntersection);
    HOperatorSet.GenEmptyObj(out ho_Rectangle);
    HOperatorSet.GenEmptyObj(out ho_ImageReduced);
    HOperatorSet.GenEmptyObj(out ho_ImagenMosFin_NIR);
    HOperatorSet.GenEmptyObj(out ho_ImageEquHisto2_NIR);
    HOperatorSet.GenEmptyObj(out ho_ImageReduced1_NIR);
    HOperatorSet.GenEmptyObj(out ho_Images);
    HOperatorSet.GenEmptyObj(out ho_Images_NIR);
    HOperatorSet.GenEmptyObj(out ho_TiledImageOriginal_NIR);
    HOperatorSet.GenEmptyObj(out ho_Region);
    HOperatorSet.GenEmptyObj(out ho_ImagenMosaickingAux_NIR);
    HOperatorSet.GenEmptyObj(out ho_ImageFFT);
    HOperatorSet.GenEmptyObj(out ho_ImageFFT2);
    HOperatorSet.GenEmptyObj(out ho_ImageCorrelation);
    HOperatorSet.GenEmptyObj(out ho_ImageFFTInv);
    hv_diff_row0 = new HTuple();
    hv_diff_col0 = new HTuple();
    try
    {
      //  Parámetros de entrada:
      //    - ImagenIni
      //    - ImagenFin
      //
      //  Parámetros de salida:
      //    - ImagenMosaicking

      hv_factor = 8;
      hv_escala = 0.125;
      hv_error_mosaiking = 1;
      hv_imagenRGB = 1;
      try
      {
        ho_R0.Dispose();ho_G.Dispose();ho_B.Dispose();
        HOperatorSet.Decompose3(ho_ImagenIni_NIR, out ho_R0, out ho_G, out ho_B);
        ho_R1.Dispose();ho_G.Dispose();ho_B.Dispose();
        HOperatorSet.Decompose3(ho_ImagenFin_NIR_COPY_INP_TMP, out ho_R1, out ho_G, 
            out ho_B);
        ho_ImagenMosIni.Dispose();
        ho_ImagenMosIni = ho_R0.CopyObj(1,-1);
        ho_ImagenFin_real.Dispose();
        ho_ImagenFin_real = ho_ImagenFin_NIR_COPY_INP_TMP.CopyObj(1,-1);
        ho_ImagenIni_real.Dispose();
        ho_ImagenIni_real = ho_ImagenIni_NIR.CopyObj(1,-1);
        ho_ImagenFin_NIR_COPY_INP_TMP.Dispose();
        ho_ImagenFin_NIR_COPY_INP_TMP = ho_R1.CopyObj(1,-1);
      }
      // catch (Exception) 
      catch (HalconException HDevExpDefaultException1)
      {
        HDevExpDefaultException1.ToHTuple(out hv_Exception);
        ho_ImagenMosIni.Dispose();
        ho_ImagenMosIni = ho_ImagenIni_NIR.CopyObj(1,-1);
        hv_imagenRGB = 0;
      }


      HOperatorSet.GetImageSize(ho_ImagenMosIni, out hv_Width, out hv_Height);
      HOperatorSet.TupleDiv(hv_Width, hv_factor, out hv_W);
      HOperatorSet.TupleDiv(hv_Height, hv_factor, out hv_H);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.ZoomImageSize(ho_ImagenMosIni, out ExpTmpOutVar_0, hv_W, hv_H, 
          "constant");
      ho_ImagenMosIni.Dispose();
      ho_ImagenMosIni = ExpTmpOutVar_0;
      }

      if ((int)(new HTuple(hv_imagenRGB.TupleEqual(1))) != 0)
      {
        ho_Mascara.Dispose();
        HOperatorSet.Threshold(ho_ImagenIni_NIR, out ho_Mascara, 1, 255);
        ho_ConnectedRegions.Dispose();
        HOperatorSet.Connection(ho_Mascara, out ho_ConnectedRegions);
        ho_SelectedRegions.Dispose();
        HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, "area", 
            "and", 1000, 99999999);
        ho_Mascara.Dispose();
        HOperatorSet.Union1(ho_SelectedRegions, out ho_Mascara);


      }
      else
      {
        ho_Mascara0.Dispose();
        HOperatorSet.Threshold(ho_ImagenIni_NIR, out ho_Mascara0, 0, 255);

        ho_ConnectedRegions.Dispose();
        HOperatorSet.Connection(ho_Mascara0, out ho_ConnectedRegions);
        ho_SelectedRegions0.Dispose();
        HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions0, "area", 
            "and", 1000, 99999999);
        //para la parte oscura del SEI
        ho_Mascara2.Dispose();
        HOperatorSet.Threshold(ho_ImagenIni_NIR, out ho_Mascara2, 0, 0);
        ho_ConnectedRegions.Dispose();
        HOperatorSet.Connection(ho_Mascara2, out ho_ConnectedRegions);
        ho_SelectedRegions1.Dispose();
        HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1, "area", 
            "and", 1000, 99999999);
        ho_Mascara.Dispose();
        HOperatorSet.Union2(ho_SelectedRegions0, ho_SelectedRegions1, out ho_Mascara
            );
        //
      }

      ho_Domain.Dispose();
      HOperatorSet.GetDomain(ho_ImagenMosIni, out ho_Domain);
      HOperatorSet.GetImageSize(ho_ImagenMosIni, out hv_Width1, out hv_Height1);
      ho_ImageEquHisto.Dispose();
      HOperatorSet.RegionToBin(ho_Domain, out ho_ImageEquHisto, 255, 0, hv_Width1, 
          hv_Height1);
      {
      HObject ExpTmpOutVar_0;
      HOperatorSet.FullDomain(ho_ImageEquHisto, out ExpTmpOutVar_0);
      ho_ImageEquHisto.Dispose();
      ho_ImageEquHisto = ExpTmpOutVar_0;
      }
      //Create template
      HOperatorSet.GetImageSize(ho_ImageEquHisto, out hv_Width, out hv_Height);
      if (HDevWindowStack.IsOpen())
      {
        //dev_display (ImageEquHisto)
      }
      //centrar
      ho_Img1.Dispose();
      HOperatorSet.ZoomRegion(ho_Mascara, out ho_Img1, hv_escala, hv_escala);
      ho_Rectangle1.Dispose();
      HOperatorSet.GenRectangle1(out ho_Rectangle1, (hv_Height*1)/4, 1, hv_Height, 
          hv_Width);
      ho_RegionIntersection.Dispose();
      HOperatorSet.Intersection(ho_Rectangle1, ho_Img1, out ho_RegionIntersection
          );
      HOperatorSet.AreaCenter(ho_RegionIntersection, out hv_Area, out hv_Row3, out hv_Column3);
      if ((int)(new HTuple(hv_Area.TupleGreater(0))) != 0)
      {
        HOperatorSet.SmallestRectangle1(ho_RegionIntersection, out hv_Row11, out hv_Column11, 
            out hv_Row2, out hv_Column21);
        hv_Row = (hv_Height*3)/4;
        //(Row2 - Row11) / 2 + Row11
        hv_Column = ((hv_Column21-hv_Column11)/2)+hv_Column11;
        hv_Phi = (new HTuple(0)).TupleRad();
        hv_Length2 = hv_Height/4;
        hv_Length1 = ((hv_Column21-hv_Column11)/2)+(32/hv_factor);
        ho_Rectangle.Dispose();
        HOperatorSet.GenRectangle2(out ho_Rectangle, hv_Row, hv_Column, hv_Phi, hv_Length1, 
            hv_Length2);


        ho_ImageReduced.Dispose();
        HOperatorSet.ReduceDomain(ho_ImageEquHisto, ho_Rectangle, out ho_ImageReduced
            );
        HOperatorSet.CreateTemplate(ho_ImageReduced, 255, 1, "sort", "original", 
            out hv_TemplateID);
        hv_Angle = 0;
        hv_TemplH2 = hv_Length2.Clone();
        hv_TemplW2 = hv_Length1.Clone();
        hv_TemplPhi = hv_Phi.Clone();
        //max_error := 40
        hv_max_error = 40;
        //ImagenMosFin_NIR := ImagenFin_NIR
        ho_Domain.Dispose();
        HOperatorSet.GetDomain(ho_ImagenFin_NIR_COPY_INP_TMP, out ho_Domain);
        HOperatorSet.GetImageSize(ho_ImagenFin_NIR_COPY_INP_TMP, out hv_Width1, out hv_Height1);
        ho_ImagenMosFin_NIR.Dispose();
        HOperatorSet.RegionToBin(ho_Domain, out ho_ImagenMosFin_NIR, 255, 0, hv_Width1, 
            hv_Height1);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.FullDomain(ho_ImagenMosFin_NIR, out ExpTmpOutVar_0);
        ho_ImagenMosFin_NIR.Dispose();
        ho_ImagenMosFin_NIR = ExpTmpOutVar_0;
        }

        HOperatorSet.GetImageSize(ho_ImagenMosFin_NIR, out hv_Width, out hv_Height);
        HOperatorSet.TupleDiv(hv_Width, hv_factor, out hv_W);
        HOperatorSet.TupleDiv(hv_Height, hv_factor, out hv_H);
        {
        HObject ExpTmpOutVar_0;
        HOperatorSet.ZoomImageSize(ho_ImagenMosFin_NIR, out ExpTmpOutVar_0, hv_W, 
            hv_H, "constant");
        ho_ImagenMosFin_NIR.Dispose();
        ho_ImagenMosFin_NIR = ExpTmpOutVar_0;
        }

        //equ_histo_image (ImagenMosFin, ImageEquHisto2)
        ho_ImageEquHisto2_NIR.Dispose();
        ho_ImageEquHisto2_NIR = ho_ImagenMosFin_NIR.CopyObj(1,-1);

        //Pattern Matching
        //best_match_mg (ImagenMosFin_NIR, TemplateID, max_error, 'true', 1, 'all', Row1, Column1, Error)
        //fast_match (ImagenMosFin_NIR, matches, TemplateID, max_error)

        HOperatorSet.BestMatch(ho_ImagenMosFin_NIR, hv_TemplateID, hv_max_error, 
            "false", out hv_Row1, out hv_Column1, out hv_Error);

        if ((int)(new HTuple(hv_Error.TupleLess(255))) != 0)
        {
          hv_error_mosaiking = 0;
          hv_diff_row0 = (-1*(hv_Row1-hv_Row))*hv_factor;
          hv_diff_col0 = (-1*(hv_Column1-hv_Column))*hv_factor;
          HOperatorSet.TupleAbs(hv_diff_col0-hv_diff_col_0, out hv_res);
          if ((int)(new HTuple(hv_res.TupleLess(125))) != 0)
          {
            hv_diff_row = hv_diff_row0.Clone();
            hv_diff_col = hv_diff_col0.Clone();
            ho_Rectangle1.Dispose();
            HOperatorSet.GenRectangle2(out ho_Rectangle1, hv_Row1, hv_Column1, hv_TemplPhi+hv_Angle, 
                hv_Length1, hv_Length2);
            if (HDevWindowStack.IsOpen())
            {
              //dev_display (ImageEquHisto2)
            }
            if (HDevWindowStack.IsOpen())
            {
              //dev_display (Rectangle1)
            }
            ho_ImageReduced1_NIR.Dispose();
            HOperatorSet.ReduceDomain(ho_ImageEquHisto2_NIR, ho_Rectangle1, out ho_ImageReduced1_NIR
                );

            HOperatorSet.GetImageSize(ho_ImagenMos_NIR, out hv_Width, out hv_Height);
            ho_Images.Dispose();
            HOperatorSet.GenEmptyObj(out ho_Images);
            ho_Images_NIR.Dispose();
            HOperatorSet.GenEmptyObj(out ho_Images_NIR);
            {
            HObject ExpTmpOutVar_0;
            HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenMos_NIR, out ExpTmpOutVar_0
                );
            ho_Images_NIR.Dispose();
            ho_Images_NIR = ExpTmpOutVar_0;
            }
            if ((int)(hv_imagenRGB) != 0)
            {
              {
              HObject ExpTmpOutVar_0;
              HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenIni_real, out ExpTmpOutVar_0
                  );
              ho_Images_NIR.Dispose();
              ho_Images_NIR = ExpTmpOutVar_0;
              }
            }
            else
            {
              {
              HObject ExpTmpOutVar_0;
              HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenIni_NIR, out ExpTmpOutVar_0
                  );
              ho_Images_NIR.Dispose();
              ho_Images_NIR = ExpTmpOutVar_0;
              }
            }
            //falta por hacer el blend de las imagens
            ho_TiledImageOriginal_NIR.Dispose();
            HOperatorSet.TileImagesOffset(ho_Images_NIR, out ho_TiledImageOriginal_NIR, 
                hv_diff_row.TupleConcat(0), hv_diff_col.TupleConcat(0), (new HTuple(-1)).TupleConcat(
                -1), (new HTuple(-1)).TupleConcat(-1), (new HTuple(-1)).TupleConcat(
                -1), (new HTuple(-1)).TupleConcat(-1), hv_Width, hv_Height*2);
            ho_Region.Dispose();
            HOperatorSet.Threshold(ho_TiledImageOriginal_NIR, out ho_Region, 0, 255);
            HOperatorSet.SmallestRectangle1(ho_Region, out hv_Fila1, out hv_Column1, 
                out hv_Fila2, out hv_Column2);
            ho_ImagenMosaickingAux_NIR.Dispose();
            HOperatorSet.CropRectangle1(ho_TiledImageOriginal_NIR, out ho_ImagenMosaickingAux_NIR, 
                0, 0, hv_Fila2, hv_Width);
            ho_ImagenMosaicking_NIR.Dispose();
            ho_ImagenMosaicking_NIR = ho_ImagenMosaickingAux_NIR.CopyObj(1,-1);

            HOperatorSet.ClearTemplate(hv_TemplateID);

            hv_diff_row0 = hv_diff_row.Clone();
            hv_diff_col0 = hv_diff_col.Clone();
          }
          else
          {
            ho_ImagenMosaicking_NIR.Dispose();
            ho_ImagenMosaicking_NIR = ho_ImagenMos_NIR.CopyObj(1,-1);
            HOperatorSet.ClearTemplate(hv_TemplateID);
            hv_diff_row0 = hv_diff_row_0.Clone();
            hv_diff_col0 = hv_diff_col_0.Clone();
          }
        }
        else
        {
          ho_ImagenMosaicking_NIR.Dispose();
          ho_ImagenMosaicking_NIR = ho_ImagenMos_NIR.CopyObj(1,-1);
          //Perform the convolution in the frequency domain

          //Compute the auto-correlation of the wafer image
          HOperatorSet.GetImageSize(ho_ImagenMosFin_NIR, out hv_Width, out hv_Height);
          ho_ImageFFT.Dispose();
          HOperatorSet.RftGeneric(ho_ImagenMosFin_NIR, out ho_ImageFFT, "to_freq", 
              "n", "complex", hv_Width);
          ho_ImageFFT2.Dispose();
          HOperatorSet.RftGeneric(ho_ImageReduced, out ho_ImageFFT2, "to_freq", "n", 
              "complex", hv_Width);
          ho_ImageCorrelation.Dispose();
          HOperatorSet.CorrelationFft(ho_ImageFFT, ho_ImageFFT2, out ho_ImageCorrelation
              );
          ho_ImageFFTInv.Dispose();
          HOperatorSet.RftGeneric(ho_ImageCorrelation, out ho_ImageFFTInv, "from_freq", 
              "n", "real", hv_Width);
          //Determine the distance between the dies
          HOperatorSet.LocalMaxSubPix(ho_ImageFFTInv, "gauss", 3, 0.0001, out hv_Row, 
              out hv_Column);
          //gen_cross_contour_xld (Cross, Row, Column, 20, rad(45))
          //Select indices of neighboring points manually
          HOperatorSet.ClearTemplate(hv_TemplateID);
          hv_diff_row = (hv_Row.TupleSelect(0))*hv_factor;
          hv_diff_col = (hv_Column.TupleSelect(0))*hv_factor;

          //falta por hacer el blend de las imagens
          ho_Images.Dispose();
          HOperatorSet.GenEmptyObj(out ho_Images);
          ho_Images_NIR.Dispose();
          HOperatorSet.GenEmptyObj(out ho_Images_NIR);
          {
          HObject ExpTmpOutVar_0;
          HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenMos_NIR, out ExpTmpOutVar_0
              );
          ho_Images_NIR.Dispose();
          ho_Images_NIR = ExpTmpOutVar_0;
          }
          if ((int)(hv_imagenRGB) != 0)
          {
            {
            HObject ExpTmpOutVar_0;
            HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenIni_real, out ExpTmpOutVar_0
                );
            ho_Images_NIR.Dispose();
            ho_Images_NIR = ExpTmpOutVar_0;
            }
          }
          else
          {
            {
            HObject ExpTmpOutVar_0;
            HOperatorSet.ConcatObj(ho_Images_NIR, ho_ImagenIni_NIR, out ExpTmpOutVar_0
                );
            ho_Images_NIR.Dispose();
            ho_Images_NIR = ExpTmpOutVar_0;
            }
          }
          HOperatorSet.GetImageSize(ho_ImagenMos_NIR, out hv_Width, out hv_Height);
          ho_TiledImageOriginal_NIR.Dispose();
          HOperatorSet.TileImagesOffset(ho_Images_NIR, out ho_TiledImageOriginal_NIR, 
              (new HTuple(0)).TupleConcat(-(hv_Height-hv_diff_row)), (new HTuple(0)).TupleConcat(
              -(hv_Width-hv_diff_col)), (new HTuple(-1)).TupleConcat(-1), (new HTuple(-1)).TupleConcat(
              -1), (new HTuple(-1)).TupleConcat(-1), (new HTuple(-1)).TupleConcat(
              -1), hv_Width, hv_Height*2);

        }

      }
      else
      {
        ho_ImagenMosaicking_NIR.Dispose();
        ho_ImagenMosaicking_NIR = ho_ImagenMos_NIR.CopyObj(1,-1);

        hv_diff_row0 = hv_diff_row_0.Clone();
        hv_diff_col0 = hv_diff_col_0.Clone();
      }

      ho_ImagenFin_NIR_COPY_INP_TMP.Dispose();
      ho_R0.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_R1.Dispose();
      ho_ImagenMosIni.Dispose();
      ho_ImagenFin_real.Dispose();
      ho_ImagenIni_real.Dispose();
      ho_Mascara.Dispose();
      ho_ConnectedRegions.Dispose();
      ho_SelectedRegions.Dispose();
      ho_Mascara0.Dispose();
      ho_SelectedRegions0.Dispose();
      ho_Mascara2.Dispose();
      ho_SelectedRegions1.Dispose();
      ho_Domain.Dispose();
      ho_ImageEquHisto.Dispose();
      ho_Img1.Dispose();
      ho_Rectangle1.Dispose();
      ho_RegionIntersection.Dispose();
      ho_Rectangle.Dispose();
      ho_ImageReduced.Dispose();
      ho_ImagenMosFin_NIR.Dispose();
      ho_ImageEquHisto2_NIR.Dispose();
      ho_ImageReduced1_NIR.Dispose();
      ho_Images.Dispose();
      ho_Images_NIR.Dispose();
      ho_TiledImageOriginal_NIR.Dispose();
      ho_Region.Dispose();
      ho_ImagenMosaickingAux_NIR.Dispose();
      ho_ImageFFT.Dispose();
      ho_ImageFFT2.Dispose();
      ho_ImageCorrelation.Dispose();
      ho_ImageFFTInv.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ImagenFin_NIR_COPY_INP_TMP.Dispose();
      ho_R0.Dispose();
      ho_G.Dispose();
      ho_B.Dispose();
      ho_R1.Dispose();
      ho_ImagenMosIni.Dispose();
      ho_ImagenFin_real.Dispose();
      ho_ImagenIni_real.Dispose();
      ho_Mascara.Dispose();
      ho_ConnectedRegions.Dispose();
      ho_SelectedRegions.Dispose();
      ho_Mascara0.Dispose();
      ho_SelectedRegions0.Dispose();
      ho_Mascara2.Dispose();
      ho_SelectedRegions1.Dispose();
      ho_Domain.Dispose();
      ho_ImageEquHisto.Dispose();
      ho_Img1.Dispose();
      ho_Rectangle1.Dispose();
      ho_RegionIntersection.Dispose();
      ho_Rectangle.Dispose();
      ho_ImageReduced.Dispose();
      ho_ImagenMosFin_NIR.Dispose();
      ho_ImageEquHisto2_NIR.Dispose();
      ho_ImageReduced1_NIR.Dispose();
      ho_Images.Dispose();
      ho_Images_NIR.Dispose();
      ho_TiledImageOriginal_NIR.Dispose();
      ho_Region.Dispose();
      ho_ImagenMosaickingAux_NIR.Dispose();
      ho_ImageFFT.Dispose();
      ho_ImageFFT2.Dispose();
      ho_ImageCorrelation.Dispose();
      ho_ImageFFTInv.Dispose();

      throw HDevExpDefaultException;
    }
  }

  public void parameters_image_to_world_plane_centered_full (HObject ho_Image1, out HObject ho_ImageWorld, 
      HTuple hv_CameraParameters, HTuple hv_CameraPose)
  {




    // Local iconic variables 

    // Local control variables 

    HTuple hv_Width = null, hv_Height = null, hv_WidthMappedImage = null;
    HTuple hv_HeightMappedImage = null, hv_CenterRow = null;
    HTuple hv_CenterCol = null, hv_Dist_ICS = null, hv_CenterX = null;
    HTuple hv_CenterY = null, hv_BelowCenterX = null, hv_BelowCenterY = null;
    HTuple hv_RightOfCenterX = null, hv_RightOfCenterY = null;
    HTuple hv_Dist_WCS_Vertical = null, hv_Dist_WCS_Horizontal = null;
    HTuple hv_ScaleVertical = null, hv_ScaleHorizontal = null;
    HTuple hv_ScaleForCenteredImage = null, hv_CenterX0 = null;
    HTuple hv_CenterY0 = null, hv_DX = null, hv_DY = null;
    HTuple hv_DZ = null, hv_PoseForCenteredImage = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_ImageWorld);
    HOperatorSet.GetImageSize(ho_Image1, out hv_Width, out hv_Height);
    HOperatorSet.GetImageSize(ho_Image1, out hv_WidthMappedImage, out hv_HeightMappedImage);
    hv_CenterRow = hv_HeightMappedImage/2;
    hv_CenterCol = hv_WidthMappedImage/2;
    //parameters_image_to_world_plane_centered
    hv_Dist_ICS = 10;
    HOperatorSet.ImagePointsToWorldPlane(hv_CameraParameters, hv_CameraPose, hv_CenterRow, 
        hv_CenterCol, "m", out hv_CenterX, out hv_CenterY);
    HOperatorSet.ImagePointsToWorldPlane(hv_CameraParameters, hv_CameraPose, hv_CenterRow+hv_Dist_ICS, 
        hv_CenterCol, "m", out hv_BelowCenterX, out hv_BelowCenterY);
    HOperatorSet.ImagePointsToWorldPlane(hv_CameraParameters, hv_CameraPose, hv_CenterRow, 
        hv_CenterCol+hv_Dist_ICS, "m", out hv_RightOfCenterX, out hv_RightOfCenterY);
    HOperatorSet.DistancePp(hv_CenterY, hv_CenterX, hv_BelowCenterY, hv_BelowCenterX, 
        out hv_Dist_WCS_Vertical);
    HOperatorSet.DistancePp(hv_CenterY, hv_CenterX, hv_RightOfCenterY, hv_RightOfCenterX, 
        out hv_Dist_WCS_Horizontal);
    hv_ScaleVertical = hv_Dist_WCS_Vertical/hv_Dist_ICS;
    hv_ScaleHorizontal = hv_Dist_WCS_Horizontal/hv_Dist_ICS;
    hv_ScaleForCenteredImage = (hv_ScaleVertical+hv_ScaleHorizontal)/2.0;
    //Determine the parameters for set_origin_pose such
    //that the point given via get_mbutton will be in the center of the
    //mapped image
    HOperatorSet.ImagePointsToWorldPlane(hv_CameraParameters, hv_CameraPose, 0, 0, 
        "m", out hv_CenterX0, out hv_CenterY0);
    hv_DX = hv_CenterX0.Clone();
    hv_DY = hv_CenterY0.Clone();
    hv_DZ = 0;

    HOperatorSet.SetOriginPose(hv_CameraPose, hv_DX, hv_DY, hv_DZ, out hv_PoseForCenteredImage);
    ho_ImageWorld.Dispose();
    HOperatorSet.ImageToWorldPlane(ho_Image1, out ho_ImageWorld, hv_CameraParameters, 
        hv_PoseForCenteredImage, hv_WidthMappedImage, hv_HeightMappedImage, hv_ScaleForCenteredImage, 
        "bilinear");

    //Now determine scale and pose such that the entire image
    //fits into the rectified image.
    //parameters_image_to_world_plane_entire (Image1, CameraParameters, CameraPose, WidthMappedImage, HeightMappedImage, ScaleForEntireImage, PoseForEntireImage)
    //image_to_world_plane (Image1, ImageWorld, CameraParameters, PoseForEntireImage, HeightMappedImage, WidthMappedImage, ScaleForEntireImage, 'bilinear')





    return;


  }

  // Short Description: Determine scale and pose such that the whole image fits into the rectified image. 
  public void parameters_image_to_world_plane_entire (HObject ho_Image, HTuple hv_CamParam, 
      HTuple hv_Pose, HTuple hv_WidthMappedImage, HTuple hv_HeightMappedImage, out HTuple hv_ScaleForEntireImage, 
      out HTuple hv_PoseForEntireImage)
  {




    // Local iconic variables 

    HObject ho_ImageFull, ho_Domain, ho_ImageBorder;
    HObject ho_ImageBorderWCS;

    // Local control variables 

    HTuple hv_MinY = null, hv_MinX = null, hv_MaxY = null;
    HTuple hv_MaxX = null, hv_ExtentX = null, hv_ExtentY = null;
    HTuple hv_ScaleX = null, hv_ScaleY = null;
    // Initialize local and output iconic variables 
    HOperatorSet.GenEmptyObj(out ho_ImageFull);
    HOperatorSet.GenEmptyObj(out ho_Domain);
    HOperatorSet.GenEmptyObj(out ho_ImageBorder);
    HOperatorSet.GenEmptyObj(out ho_ImageBorderWCS);
    try
    {
      //Transform the image border into the WCS (scale = 1)
      ho_ImageFull.Dispose();
      HOperatorSet.FullDomain(ho_Image, out ho_ImageFull);
      ho_Domain.Dispose();
      HOperatorSet.GetDomain(ho_ImageFull, out ho_Domain);
      ho_ImageBorder.Dispose();
      HOperatorSet.GenContourRegionXld(ho_Domain, out ho_ImageBorder, "border");
      ho_ImageBorderWCS.Dispose();
      HOperatorSet.ContourToWorldPlaneXld(ho_ImageBorder, out ho_ImageBorderWCS, 
          hv_CamParam, hv_Pose, 1);
      HOperatorSet.SmallestRectangle1Xld(ho_ImageBorderWCS, out hv_MinY, out hv_MinX, 
          out hv_MaxY, out hv_MaxX);
      //Determine the scale of the mapping
      hv_ExtentX = hv_MaxX-hv_MinX;
      hv_ExtentY = hv_MaxY-hv_MinY;
      hv_ScaleX = hv_ExtentX/hv_WidthMappedImage;
      hv_ScaleY = hv_ExtentY/hv_HeightMappedImage;
      hv_ScaleForEntireImage = ((hv_ScaleX.TupleConcat(hv_ScaleY))).TupleMax();
      //Shift the pose by the minimum X and Y coordinates
      HOperatorSet.SetOriginPose(hv_Pose, hv_MinX, hv_MinY, 0, out hv_PoseForEntireImage);
      ho_ImageFull.Dispose();
      ho_Domain.Dispose();
      ho_ImageBorder.Dispose();
      ho_ImageBorderWCS.Dispose();

      return;
    }
    catch (HalconException HDevExpDefaultException)
    {
      ho_ImageFull.Dispose();
      ho_Domain.Dispose();
      ho_ImageBorder.Dispose();
      ho_ImageBorderWCS.Dispose();

      throw HDevExpDefaultException;
    }
  }
